<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Quantitative Artisan</title><link href="http://www.quantisan.com/" rel="alternate"></link><link href="http://www.quantisan.com/feeds/tag/etf_atom.xml" rel="self"></link><id>http://www.quantisan.com/</id><updated>2013-01-31T12:30:00+00:00</updated><entry><title>Minimal variance asset allocation for Stocks ISA</title><link href="http://www.quantisan.com/minimal-variance-asset-allocation-for-stocks-isa/" rel="alternate"></link><updated>2013-01-31T12:30:00+00:00</updated><author><name>Paul Lam</name></author><id>tag:www.quantisan.com,2013-01-31:minimal-variance-asset-allocation-for-stocks-isa/</id><summary type="html">&lt;p&gt;With interest rate in the UK so pathetically low, I thought I might take some chance by making use of a Stocks ISA account in the UK. The problem though, is that I have no knowledge about the London stock market nor do I have the time to follow it. So I wrote a program to pick some Exchange Traded Funds (ETFs) with a primary goal to minimise risk and opportunity costs.&lt;/p&gt;
&lt;p&gt;Here are what I wanted to achieve:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;only a few trades at most a year&lt;/li&gt;
&lt;li&gt;less risk than FTSE100&lt;/li&gt;
&lt;li&gt;more yield than a laddered government bonds portfolio&lt;/li&gt;
&lt;li&gt;require less than an hour per month of maintenance&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Basically, this is a computer-assisted passive investment portfolio.&lt;/p&gt;
&lt;p&gt;The first step is to scrape all the ETF symbols from London Stock Exchange on &lt;a href="http://www.londonstockexchange.com/exchange/prices-and-markets/ETFs/ETFs.html"&gt;these pages&lt;/a&gt;. I use &lt;code&gt;getNodeSet&lt;/code&gt; from &lt;code&gt;XML&lt;/code&gt; package in R to select the relevant data from the HTML page with XPath.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;page &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; getURL&lt;span class="p"&gt;(&lt;/span&gt;url&lt;span class="p"&gt;,&lt;/span&gt; curl&lt;span class="o"&gt;=&lt;/span&gt;curl&lt;span class="p"&gt;)&lt;/span&gt;
tree &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; htmlTreeParse&lt;span class="p"&gt;(&lt;/span&gt;page&lt;span class="p"&gt;,&lt;/span&gt; useInternalNodes&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
xpath &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;//table[@class = &amp;#39;table_dati&amp;#39;]/tbody&amp;quot;&lt;/span&gt;
node &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; getNodeSet&lt;span class="p"&gt;(&lt;/span&gt;tree&lt;span class="p"&gt;,&lt;/span&gt; xpath&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This program only considers ETF because this portfolio is to diversify risk and not pick &lt;em&gt;winning&lt;/em&gt; stocks. ETFs provide &lt;a href="http://www.economist.com/news/finance-and-economics/21570711-anniversary-successful-financial-innovation-twenty-years-young"&gt;convenient exposure to various asset classes such as equities, bonds, and commodities at low costs&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Next is to scrape profile information for each symbol from Yahoo. We want data such as the fund's expense ratio and asset class category.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;url &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; paste&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;http://finance.yahoo.com/q/pr?s=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; symbol&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;+Profile&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; sep&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
tree &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; htmlTreeParse&lt;span class="p"&gt;(&lt;/span&gt;url&lt;span class="p"&gt;,&lt;/span&gt; useInternalNodes&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
xpath &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;//table[contains(concat(&amp;#39; &amp;#39;, @class, &amp;#39; &amp;#39;), &amp;#39; yfnc_datamodoutline1 &amp;#39;)]/tr/td/table&amp;quot;&lt;/span&gt;
node &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; getNodeSet&lt;span class="p"&gt;(&lt;/span&gt;tree&lt;span class="p"&gt;,&lt;/span&gt; xpath&lt;span class="p"&gt;)&lt;/span&gt;

operation &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; tryCatch&lt;span class="p"&gt;(&lt;/span&gt;readHTMLTable&lt;span class="p"&gt;(&lt;/span&gt;node&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]]),&lt;/span&gt; error &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;e&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="kc"&gt;NA&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
overview &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; tryCatch&lt;span class="p"&gt;(&lt;/span&gt;readHTMLTable&lt;span class="p"&gt;(&lt;/span&gt;node&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]]),&lt;/span&gt; error &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;e&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="kc"&gt;NA&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Once the funds' fundamental data are fetched, we can do a preliminary screening. I am filtering for:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Actively traded funds,&lt;/li&gt;
&lt;li&gt;Sufficient age (3 years), and&lt;/li&gt;
&lt;li&gt;Only the best 3 expense ratio efficiency from each class&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;That last point is particularly important as illustrated in this plot.&lt;/p&gt;
&lt;p&gt;&lt;img alt="London funds expense by category" src="http://www.quantisan.com/images/2013/london_etf_mer_category.png" /&gt;&lt;/p&gt;
&lt;p&gt;The above plot couldn't fit in this frame but it shows that expense ratios are all over the place. What matters is that the raw data is available for use.&lt;/p&gt;
&lt;p&gt;The plot below is clearer. It shows expense ratio by the fund's issuer. You can see that Vanguard funds generally have the best expense ratio as is commonly known.&lt;/p&gt;
&lt;p&gt;&lt;img alt="London funds expense by issuer" src="http://www.quantisan.com/images/2013/london_etf_mer.png" /&gt;&lt;/p&gt;
&lt;p&gt;The initial ETF list has 667 funds in 104 categories. The screened list narrows it down to 20 funds in 18 categories. Most that were screened are niche funds such as Islamic Global Equity and regional real estate funds.&lt;/p&gt;
&lt;p&gt;Out of that 20 funds, I apply the popular &lt;a href="http://en.wikipedia.org/wiki/Modern_portfolio_theory"&gt;Modern Portfolio Theory&lt;/a&gt; to minimise risk using historical quotes data with &lt;code&gt;quantmod&lt;/code&gt;'s Yahoo data fetcher. Given the expected returns of each asset, &lt;code&gt;er&lt;/code&gt; and their covariance matrix, &lt;code&gt;cov.mat&lt;/code&gt;, a long-only efficient portfolio weighting of those assets can be solved with quadratic programming like so.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;Dmat &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;cov.mat
dvec &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; rep.int&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; N&lt;span class="p"&gt;)&lt;/span&gt;
Amat &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; cbind&lt;span class="p"&gt;(&lt;/span&gt;rep&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;N&lt;span class="p"&gt;),&lt;/span&gt; er&lt;span class="p"&gt;,&lt;/span&gt; diag&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;N&lt;span class="p"&gt;))&lt;/span&gt;
bvec &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; c&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; target.return&lt;span class="p"&gt;,&lt;/span&gt; rep&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;N&lt;span class="p"&gt;))&lt;/span&gt;
result &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; solve.QP&lt;span class="p"&gt;(&lt;/span&gt;Dmat&lt;span class="o"&gt;=&lt;/span&gt;Dmat&lt;span class="p"&gt;,&lt;/span&gt;dvec&lt;span class="o"&gt;=&lt;/span&gt;dvec&lt;span class="p"&gt;,&lt;/span&gt;Amat&lt;span class="o"&gt;=&lt;/span&gt;Amat&lt;span class="p"&gt;,&lt;/span&gt;bvec&lt;span class="o"&gt;=&lt;/span&gt;bvec&lt;span class="p"&gt;,&lt;/span&gt;meq&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;To get these weightings,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;IGLT&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;   &lt;span class="n"&gt;MIDD&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;   &lt;span class="n"&gt;INXG&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;   &lt;span class="n"&gt;EQQQ&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;   &lt;span class="n"&gt;SLXX&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;   &lt;span class="n"&gt;IBGS&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;   &lt;span class="n"&gt;IUKP&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;   &lt;span class="n"&gt;LUK2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt; 
&lt;span class="mf"&gt;0.603023&lt;/span&gt; &lt;span class="mf"&gt;0.122829&lt;/span&gt; &lt;span class="mf"&gt;0.116879&lt;/span&gt; &lt;span class="mf"&gt;0.084122&lt;/span&gt; &lt;span class="mf"&gt;0.037906&lt;/span&gt; &lt;span class="mf"&gt;0.017975&lt;/span&gt; &lt;span class="mf"&gt;0.014051&lt;/span&gt; &lt;span class="mf"&gt;0.003215&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;But here's the catch, this mean-variance optimisation approach which I'm using does not work in the real-world. The problem is that it optimises for historical data under simplistic assumptions. For potential improvements on this model, start with &lt;a href="http://quant.stackexchange.com/questions/44/what-methods-do-you-use-to-improve-expected-return-estimates-when-constructing-a"&gt;this Q&amp;amp;A on StackExchange&lt;/a&gt; but be warned that it's a rabbit hole to go down in.&lt;/p&gt;
&lt;p&gt;Knowing that I shouldn't trust this model much, I do this a couple times under different scenarios on the efficient frontier and union the top weighted assets from each run as a compensation by sampling.&lt;/p&gt;
&lt;p&gt;The result is a suggestion of six ETFs.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;Symbol&lt;/span&gt;            &lt;span class="n"&gt;Name&lt;/span&gt;                   &lt;span class="n"&gt;category&lt;/span&gt;
&lt;span class="n"&gt;BRIC&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;    &lt;span class="n"&gt;ISHARESII&lt;/span&gt; &lt;span class="mi"&gt;50&lt;/span&gt;                &lt;span class="n"&gt;BRIC&lt;/span&gt; &lt;span class="n"&gt;Equity&lt;/span&gt;
&lt;span class="n"&gt;EQQQ&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;   &lt;span class="n"&gt;POWERSHS&lt;/span&gt; &lt;span class="n"&gt;EQQQ&lt;/span&gt; &lt;span class="n"&gt;US&lt;/span&gt; &lt;span class="n"&gt;Large&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Cap&lt;/span&gt; &lt;span class="n"&gt;Growth&lt;/span&gt; &lt;span class="n"&gt;Equity&lt;/span&gt;
&lt;span class="n"&gt;IGLS&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt; &lt;span class="n"&gt;ISHARESIII&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="err"&gt;£&lt;/span&gt;        &lt;span class="n"&gt;GBP&lt;/span&gt; &lt;span class="n"&gt;Government&lt;/span&gt; &lt;span class="n"&gt;Bond&lt;/span&gt;
&lt;span class="n"&gt;INXG&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt; &lt;span class="n"&gt;GBP&lt;/span&gt; &lt;span class="n"&gt;IDX&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;LNK&lt;/span&gt; &lt;span class="n"&gt;GLT&lt;/span&gt;  &lt;span class="n"&gt;GBP&lt;/span&gt; &lt;span class="n"&gt;Inflation&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Linked&lt;/span&gt; &lt;span class="n"&gt;Bond&lt;/span&gt;
&lt;span class="n"&gt;MIDD&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;  &lt;span class="n"&gt;ISHARESFTSE250&lt;/span&gt;          &lt;span class="n"&gt;UK&lt;/span&gt; &lt;span class="n"&gt;Mid&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Cap&lt;/span&gt; &lt;span class="n"&gt;Equity&lt;/span&gt;
&lt;span class="n"&gt;SLXX&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt; &lt;span class="n"&gt;ISHSIII&lt;/span&gt; &lt;span class="n"&gt;IBX&lt;/span&gt; &lt;span class="err"&gt;£&lt;/span&gt;&lt;span class="n"&gt;CB&lt;/span&gt;         &lt;span class="n"&gt;GBP&lt;/span&gt; &lt;span class="n"&gt;Corporate&lt;/span&gt; &lt;span class="n"&gt;Bond&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Out of these I hand picked IGLS.L and MIDD.L for a conservative 80% bonds and 20% equity portfolio. This plot below shows the annualised return versus risk of ISF (FTSE100), an equal-weighted portfolio of the pre-screened 20 ETFs, and this final portfolio of two ETFs. Notice the historic risk of this final portfolio is a third of FTSE100.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Return vs risk" src="http://www.quantisan.com/images/2013/london_etf_rr.png" /&gt;&lt;/p&gt;
&lt;p&gt;Not surprisingly, what my program derived from scratch is similar to the commonly suggested portfolio balance of bonds, local equities, and emerging market blend. What this program offers is picking out the specific ETFs from the hundreds of ETFs traded on London Stock Exchange for a balanced asset allocation.&lt;/p&gt;
&lt;p&gt;The complete R source code for this project is &lt;a href="https://github.com/Quantisan/touzi"&gt;available on Github&lt;/a&gt;.&lt;/p&gt;</summary><category term="London"></category><category term="ETF"></category><category term="R"></category></entry></feed>