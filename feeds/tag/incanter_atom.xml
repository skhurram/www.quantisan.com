<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Paul Lam</title><link href="http://www.quantisan.com/" rel="alternate"></link><link href="http://www.quantisan.com/feeds/tag/incanter_atom.xml" rel="self"></link><id>http://www.quantisan.com/</id><updated>2012-12-31T15:42:00-05:00</updated><entry><title>Unlock Lisp sorcery in your data structure by implementing Clojure ISeq</title><link href="http://www.quantisan.com/unlock-lisp-sorcery-in-your-data-structure-by-implementing-clojure-iseq/" rel="alternate"></link><updated>2012-12-31T15:42:00-05:00</updated><author><name>Paul Lam</name></author><id>tag:www.quantisan.com,2012-12-31:unlock-lisp-sorcery-in-your-data-structure-by-implementing-clojure-iseq/</id><summary type="html">&lt;p&gt;People that has gone through The Little Schemer might not find this exciting. One of the things that I discovered while patching &lt;a href="http://quantisan.github.com/clatrix/"&gt;Clatrix&lt;/a&gt; is that implementing clojure.lang.ISeq interface in your custom data structure unlocks the magic of Lisp composition. By enabling primative operators such as &lt;code&gt;first&lt;/code&gt;, &lt;code&gt;next&lt;/code&gt;, &lt;code&gt;more&lt;/code&gt;, &lt;code&gt;cons&lt;/code&gt;, higher-level operations such as &lt;code&gt;map&lt;/code&gt; and &lt;code&gt;reduce&lt;/code&gt; would just work when operating on your data structure. I find it fascinating that a native Fortran matrix object (through jBLAS) can be made clojury with a few magic operations implemented.&lt;/p&gt;
&lt;p&gt;However, getting a &lt;code&gt;deftype&lt;/code&gt; implementation of &lt;code&gt;Matrix&lt;/code&gt; correct took some effort as these operators are not as simple as they seem.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;ISeq&lt;/span&gt; &lt;span class="kd"&gt;extends&lt;/span&gt; &lt;span class="n"&gt;IPersistentCollection&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;Object&lt;/span&gt; &lt;span class="nf"&gt;first&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
    &lt;span class="n"&gt;ISeq&lt;/span&gt; &lt;span class="nf"&gt;next&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
    &lt;span class="n"&gt;ISeq&lt;/span&gt; &lt;span class="nf"&gt;more&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
    &lt;span class="n"&gt;ISeq&lt;/span&gt; &lt;span class="nf"&gt;cons&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt; &lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;For example, say we have a matrix &lt;code&gt;M&lt;/code&gt; like so.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;def &lt;/span&gt;&lt;span class="nv"&gt;M&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;matrix&lt;/span&gt; &lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;]]))&lt;/span&gt;
&lt;span class="nv"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nv"&gt;M&lt;/span&gt;
&lt;span class="nv"&gt;A&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="nv"&gt;x3&lt;/span&gt; &lt;span class="nv"&gt;matrix&lt;/span&gt;
&lt;span class="nv"&gt;-------------&lt;/span&gt;
&lt;span class="mf"&gt;1.00&lt;/span&gt;&lt;span class="nv"&gt;e+00&lt;/span&gt;  &lt;span class="mf"&gt;2.00&lt;/span&gt;&lt;span class="nv"&gt;e+00&lt;/span&gt;  &lt;span class="mf"&gt;3.00&lt;/span&gt;&lt;span class="nv"&gt;e+00&lt;/span&gt; 
&lt;span class="mf"&gt;4.00&lt;/span&gt;&lt;span class="nv"&gt;e+00&lt;/span&gt;  &lt;span class="mf"&gt;5.00&lt;/span&gt;&lt;span class="nv"&gt;e+00&lt;/span&gt;  &lt;span class="mf"&gt;6.00&lt;/span&gt;&lt;span class="nv"&gt;e+00&lt;/span&gt; 
&lt;span class="mf"&gt;7.00&lt;/span&gt;&lt;span class="nv"&gt;e+00&lt;/span&gt;  &lt;span class="mf"&gt;8.00&lt;/span&gt;&lt;span class="nv"&gt;e+00&lt;/span&gt;  &lt;span class="mf"&gt;9.00&lt;/span&gt;&lt;span class="nv"&gt;e+00&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Reducing &lt;code&gt;M&lt;/code&gt; across its maps is equivalent to a column-wise operation.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;reduce &lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;map + &lt;/span&gt;&lt;span class="nv"&gt;%1&lt;/span&gt; &lt;span class="nv"&gt;%2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="nv"&gt;M&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;12.0&lt;/span&gt; &lt;span class="mf"&gt;15.0&lt;/span&gt; &lt;span class="mf"&gt;18.0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Yet for a while this doesn't work because I wasn't careful on my implementation of &lt;code&gt;first&lt;/code&gt;. &lt;/p&gt;
&lt;p&gt;Consider the case of a 2x2 matrix. A 2x2 matrix is structurally equivalent to a nested vector. Calling &lt;code&gt;first&lt;/code&gt; on these would yield:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;first &lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]])&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nv"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;first &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;matrix&lt;/span&gt; &lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]]))&lt;/span&gt;
&lt;span class="nv"&gt;A&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="nv"&gt;x2&lt;/span&gt; &lt;span class="nv"&gt;matrix&lt;/span&gt;
&lt;span class="nv"&gt;-------------&lt;/span&gt;
&lt;span class="mf"&gt;1.00&lt;/span&gt;&lt;span class="nv"&gt;e+00&lt;/span&gt;  &lt;span class="mf"&gt;2.00&lt;/span&gt;&lt;span class="nv"&gt;e+00&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And for a 3x1 vector matrix, i.e. one-dimensional, it is equivalent to a regular vector.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;first &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="nv"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;first &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;matrix&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;
&lt;span class="mf"&gt;1.0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;But here's a tricky bit. What happens during &lt;code&gt;reduce&lt;/code&gt; as it keeps recurring &lt;code&gt;next&lt;/code&gt; and &lt;code&gt;first&lt;/code&gt;?&lt;/p&gt;
&lt;p&gt;Let's step this through for &lt;code&gt;(reduce #(map + %1 %2) M)&lt;/code&gt;. &lt;code&gt;%1&lt;/code&gt; is basically the result so far and &lt;code&gt;%2&lt;/code&gt; is the &lt;code&gt;first&lt;/code&gt; of the remaining collection to be processed.&lt;/p&gt;
&lt;table border="1"&gt;
    &lt;tr&gt;&lt;th&gt;iteration&lt;/th&gt;&lt;th&gt;accumulated (%1)&lt;/th&gt;&lt;th&gt;first (%2)&lt;/th&gt;&lt;th&gt;remaining&lt;/th&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;nil&lt;/td&gt;&lt;td&gt;[1 2 3]&lt;/td&gt;&lt;td&gt;[[1 2 3] [4 5 6] [7 8 9]]&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;1&lt;/td&gt;&lt;td&gt;[1 2 3]&lt;/td&gt;&lt;td&gt;[4 5 6]&lt;/td&gt;&lt;td&gt;[[4 5 6] [7 8 9]]&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;2, bad&lt;/td&gt;&lt;td&gt;[5 7 9]&lt;/td&gt;&lt;td&gt;7&lt;/td&gt;&lt;td&gt;[[7 8 9]]&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;2, good&lt;/td&gt;&lt;td&gt;[5 7 9]&lt;/td&gt;&lt;td&gt;[7 8 9]&lt;/td&gt;&lt;td&gt;[[7 8 9]]&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;

&lt;p&gt;The problem arises in the second iteration. Calling &lt;code&gt;(rest [[4 5 6] [7 8 9]])&lt;/code&gt; returns &lt;code&gt;[[7 8 9]]&lt;/code&gt;. However, &lt;code&gt;(matrix [[7 8 9]])&lt;/code&gt; is a row vector and &lt;code&gt;(matrix [7 8 9])&lt;/code&gt; is a column vector. Both are considered one dimensional. In either case, &lt;code&gt;first&lt;/code&gt; of a vector should return the first element, which is a number. Thus at this iteration, &lt;code&gt;reduce&lt;/code&gt; breaks because you can't map a sequence with a number, &lt;code&gt;(map + [5 7 9] 7)&lt;/code&gt;, to get an accumulated value.&lt;/p&gt;
&lt;p&gt;What we want though, is for the second iteration to return &lt;code&gt;[7 8 9]&lt;/code&gt; instead because the &lt;em&gt;original&lt;/em&gt; matrix is not a vector. Luckily, this particular problem has been solved by my colleague &lt;a href="https://github.com/antoniogarrote"&gt;Antonio Garrote&lt;/a&gt; when he &lt;a href="https://github.com/forward/incanter-BLAS"&gt;did this in Java a year ago&lt;/a&gt; by keeping a predicate field signifying is &lt;em&gt;this&lt;/em&gt; matrix supposed to be vector or not.&lt;/p&gt;
&lt;p&gt;So there you have it. If you find yourself needing to implement &lt;code&gt;deftype&lt;/code&gt; to build your own data structure in Clojure. Do consider implementing &lt;code&gt;clojure.lang.ISeq&lt;/code&gt; to leverage high-level Clojure functions but be careful about those seemingly simplistic primitive operators.&lt;/p&gt;</summary><category term="clojure"></category><category term="Incanter"></category></entry><entry><title>A hypothetical data analysis platform</title><link href="http://www.quantisan.com/a-hypothetical-data-analysis-platform/" rel="alternate"></link><updated>2012-11-10T12:03:00-05:00</updated><author><name>Paul Lam</name></author><id>tag:www.quantisan.com,2012-11-10:a-hypothetical-data-analysis-platform/</id><summary type="html">&lt;p&gt;My definition of a statistical platform is that it is a glue that ties orthogonal data analysis functions together. Take R for instance, it is a platform-as-application. You fire up R and everything is accessible to you. However, all the packages only work on top of R.&lt;/p&gt;
&lt;p&gt;Python, on the other hand, take a platform-as-libraries approach. A basic data analaysis setup is to &lt;code&gt;pip install Numpy, Scipy, Matplotlib&lt;/code&gt;. High-level libraries, such as scikit-learn and pandas, are built on top of these. It is somewhat more flexible for picking and choosing but the dependency is still a tree-like structure between some packages.&lt;/p&gt;
&lt;p&gt;Then there's Incanter.&lt;/p&gt;
&lt;p&gt;You don't like to use Parallel Colt for your matrices? Here, try &lt;a href="https://github.com/forward/incanter-BLAS"&gt;this BLAS drop-in replacement&lt;/a&gt; and everything would just work with 10x speed. &lt;/p&gt;
&lt;p&gt;Much of this flexibility is due to earlier design choices by Liebke et al. to leverage Clojure's idiom that "it is better to have 100 functions operate on one data structure than to have 10 functions operate on 10 data structures."&lt;/p&gt;
&lt;p&gt;The thing is, I think we're only scratching the surface. Excuse me while I dream for a minute.&lt;/p&gt;
&lt;p&gt;Say instead of jBLAS, you want to use CPU/GPU hybrid instead. Suppose you can just do a &lt;code&gt;(use 'incanter-magma)&lt;/code&gt; and your Incanter code would just run with &lt;a href="http://icl.cs.utk.edu/magma/software/index.html"&gt;MAGMA&lt;/a&gt; (via &lt;a href="http://matthewrocklin.com/"&gt;Mathew Rocklin&lt;/a&gt;) under the hood without any other change.&lt;/p&gt;
&lt;p&gt;Taking this idea of interfacing libraries into a hypothetical use case. Imagine that you cleaned and structured your data on Hadoop using &lt;a href="http://cascalog.org/"&gt;Cascalog&lt;/a&gt; and is looking to analyse this dataset. You start your Incanter session to pull in your data &lt;code&gt;(use 'incanter-cascalog)&lt;/code&gt;. Write some Incanter script to interrogate this dataset but find the data is still too big for your laptop. So you &lt;code&gt;(use 'incanter-storm)&lt;/code&gt; to make use of distributed processing instead. Incanter would then flow data directly from Cascalog to &lt;a href="http://storm-project.net/"&gt;Storm&lt;/a&gt; inside your cluster.&lt;/p&gt;
&lt;p&gt;For your results, you find JFreeChart limiting so you &lt;code&gt;(use 'incanter-c2)&lt;/code&gt; to spiff up your visualisations with &lt;a href="http://keminglabs.com/c2/"&gt;C2&lt;/a&gt; all while not changing a single line of your Incanter script.&lt;/p&gt;
&lt;p&gt;Instead of the star-like dependency of R and its packages, or the tree-like structure for Python and its packages, Incanter could be an interface to stand-alone libraries encapsulated by an application for the user.&lt;/p&gt;
&lt;p&gt;Incanter, the library, could be modules that transform data into standard Incanter-compatible data structures to and from external libraries. Incanter, the application, could be a domain specific language, a client, and a in-REPL package manager.&lt;/p&gt;
&lt;p&gt;Another benefit to this is that it helps to mitigate the developer shortage problem for Incanter too by making use of external, stand-alone libraries.&lt;/p&gt;
&lt;p&gt;I call this platform-as-interface.&lt;/p&gt;</summary><category term="R"></category><category term="Python"></category><category term="Incanter"></category><category term="data analysis"></category><category term="clojure"></category></entry><entry><title>Vector algorithm using tree composition</title><link href="http://www.quantisan.com/vector-algorithm-using-tree-composition/" rel="alternate"></link><updated>2011-08-07T09:43:00-04:00</updated><author><name>Paul Lam</name></author><id>tag:www.quantisan.com,2011-08-07:vector-algorithm-using-tree-composition/</id><summary type="html">&lt;p&gt;Sniffed this trick from the Incanter source. Here's a demo of using tree
composition to calculate a 2-d Euclidean distance between two points.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;def &lt;/span&gt;&lt;span class="nv"&gt;x&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; 
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;def &lt;/span&gt;&lt;span class="nv"&gt;y&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; 
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;defn- &lt;/span&gt;&lt;span class="nv"&gt;tree-comp-each&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;root &lt;/span&gt;&lt;span class="nv"&gt;branch&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="nv"&gt;leaves&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;apply root &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;map &lt;/span&gt;&lt;span class="nv"&gt;branch&lt;/span&gt; &lt;span class="nv"&gt;leaves&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt; 
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;defn &lt;/span&gt;&lt;span class="nv"&gt;euclidean-distance&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;a&lt;/span&gt; &lt;span class="nv"&gt;b&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="ss"&gt;:pre&lt;/span&gt; &lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="nb"&gt;= &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;count &lt;/span&gt;&lt;span class="nv"&gt;a&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;count &lt;/span&gt;&lt;span class="nv"&gt;b&lt;/span&gt;&lt;span class="p"&gt;))]}&lt;/span&gt; 
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;sqrt&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;apply &lt;/span&gt;&lt;span class="nv"&gt;tree-comp-each&lt;/span&gt; &lt;span class="nb"&gt;+ &lt;/span&gt;
                &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;fn &lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="nv"&gt;x&lt;/span&gt; &lt;span class="nv"&gt;y&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;
                    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;pow&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;- &lt;/span&gt;&lt;span class="nv"&gt;x&lt;/span&gt; &lt;span class="nv"&gt;y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; 
                &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;map vector &lt;/span&gt;&lt;span class="nv"&gt;a&lt;/span&gt; &lt;span class="nv"&gt;b&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;I've only had exposures to tree traversal in the use of implementing searching and sorting
algorithms. This trick here definitely widened my eyes to the wonders of
functional programming. It's more than just being able to pass and
manipulate functions. I need to think like a tree.&lt;/p&gt;</summary><category term="clojure"></category><category term="source code"></category><category term="Incanter"></category></entry><entry><title>First impression of Incanter: usably incomplete</title><link href="http://www.quantisan.com/first-impression-of-incanter-usably-incomplete/" rel="alternate"></link><updated>2011-06-25T20:43:00-04:00</updated><author><name>Paul Lam</name></author><id>tag:www.quantisan.com,2011-06-25:first-impression-of-incanter-usably-incomplete/</id><summary type="html">&lt;p&gt;Speaking out loud about my new favourite toys, Clojure (a functional
programming language) and Incanter (a R-like statistical platform built
on Clojure). My first impression is that Incanter is usable but it is
far from being polished like R since it is a new platform. I am using
the Gold Miners ETF (GDX) and Gold Trust (GLD) data from Yahoo Finance
as examples to perform a simple correlation test. Some Incanter
functions are rough on the edges and a lot is left to be desired. This
is a drastic contrast to R in which its plug-in modules are both
impressive and comprehensive. On the other hand, making things happen
with Clojure is ... fun. And that's a winner for me. Here's a walk
through of my first attempt using Incanter to analyse stocks data.
Figures 1 and 2 below are basic time series plot of GDX and GLD. I'll
need to study the Incanter source code to figure out how to plot
multiple time series on the same chart. Couldn't find it on a first
glimpse though. [caption id="attachment_5535" align="aligncenter"
width="488" caption="GDX"]&lt;img alt="" src="http://www.quantisan.com/static/images/2011/06/incanter-chart-GDX.png" title="incanter-chart-GDX" /&gt;[/caption] [caption id="attachment_5536"
align="aligncenter" width="488" caption="GLD"]&lt;img alt="" src="http://www.quantisan.com/static/images/2011/06/incanter-chart-GLD.png" title="incanter-chart-GLD" /&gt;[/caption] The
following looks like a lot of code just to plot two graphs. Most of the
boilerplate code is to coerce the Yahoo Finance CSV data to specifically
fit Incanter's time-series-plot function. I will wrap this into a
library later on.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;ns &lt;/span&gt;&lt;span class="nv"&gt;inc-sandbox.corr-demo&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:require&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;clojure.set&lt;/span&gt; &lt;span class="ss"&gt;:as&lt;/span&gt; &lt;span class="nv"&gt;set&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:use&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;incanter&lt;/span&gt; &lt;span class="nv"&gt;core&lt;/span&gt; &lt;span class="nv"&gt;stats&lt;/span&gt; &lt;span class="nv"&gt;charts&lt;/span&gt; &lt;span class="nv"&gt;io&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:require&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;clj-time.core&lt;/span&gt; &lt;span class="ss"&gt;:as&lt;/span&gt; &lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:use&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;clj-time&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;format&lt;/span&gt; &lt;span class="ss"&gt;:only&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;formatter&lt;/span&gt;
&lt;span class="nv"&gt;formatters&lt;/span&gt; &lt;span class="nv"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;coerce&lt;/span&gt; &lt;span class="ss"&gt;:only&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;to-long&lt;/span&gt;&lt;span class="p"&gt;)])))&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;defn &lt;/span&gt;&lt;span class="nv"&gt;sym-to-dataset&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;returns a dataset read from a local CSV in &amp;#39;./data/&amp;#39; given a Yahoo&lt;/span&gt;
&lt;span class="s"&gt;Finance symbol name&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;yf-symbol&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;+data&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;./data/&amp;quot;&lt;/span&gt; &lt;span class="nv"&gt;+csv&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;.csv&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;symbol &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;.toUpperCase&lt;/span&gt; &lt;span class="nv"&gt;yf-symbol&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="nv"&gt;filename&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str &lt;/span&gt;&lt;span class="nv"&gt;+data&lt;/span&gt; &lt;span class="nb"&gt;symbol &lt;/span&gt;&lt;span class="nv"&gt;+csv&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;-&lt;/span&gt;&lt;span class="sc"&gt;\&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;read-dataset&lt;/span&gt; &lt;span class="nv"&gt;filename&lt;/span&gt; &lt;span class="ss"&gt;:header&lt;/span&gt; &lt;span class="nv"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;col-names&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:Date&lt;/span&gt; &lt;span class="ss"&gt;:Open&lt;/span&gt; &lt;span class="ss"&gt;:High&lt;/span&gt; &lt;span class="ss"&gt;:Low&lt;/span&gt;
&lt;span class="ss"&gt;:Close&lt;/span&gt; &lt;span class="ss"&gt;:Volume&lt;/span&gt; &lt;span class="ss"&gt;:Adj-Close&lt;/span&gt;&lt;span class="p"&gt;]))))&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;def &lt;/span&gt;&lt;span class="nv"&gt;gdx&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;sym-to-dataset&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;GDX&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;def &lt;/span&gt;&lt;span class="nv"&gt;gld&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;sym-to-dataset&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;GLD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;defn &lt;/span&gt;&lt;span class="nv"&gt;same-dates?&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;are two datasets covering the&lt;/span&gt;
&lt;span class="s"&gt;same time frame?&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;x&lt;/span&gt; &lt;span class="nv"&gt;y&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;x-dates&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;into &lt;/span&gt;&lt;span class="sc"&gt;\#&lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sc"&gt;\$&lt;/span&gt; &lt;span class="ss"&gt;:Date&lt;/span&gt; &lt;span class="nv"&gt;x&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="nv"&gt;y-dates&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;into &lt;/span&gt;&lt;span class="sc"&gt;\#&lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sc"&gt;\$&lt;/span&gt; &lt;span class="ss"&gt;:Date&lt;/span&gt; &lt;span class="nv"&gt;y&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="nv"&gt;x-y&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;clojure.set/difference&lt;/span&gt; &lt;span class="nv"&gt;x-dates&lt;/span&gt; &lt;span class="nv"&gt;y-dates&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;y-x&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;clojure.set/difference&lt;/span&gt; &lt;span class="nv"&gt;y-dates&lt;/span&gt; &lt;span class="nv"&gt;x-dates&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;and &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;empty?&lt;/span&gt; &lt;span class="nv"&gt;x-y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;empty?&lt;/span&gt;
&lt;span class="nv"&gt;y-x&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;same-dates?&lt;/span&gt; &lt;span class="nv"&gt;gdx&lt;/span&gt; &lt;span class="nv"&gt;gld&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;; true (def gdx-ac (\$ :Adj-Close gdx))&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;def &lt;/span&gt;&lt;span class="nv"&gt;gld-ac&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sc"&gt;\$&lt;/span&gt; &lt;span class="ss"&gt;:Adj-Close&lt;/span&gt; &lt;span class="nv"&gt;gld&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;defn &lt;/span&gt;&lt;span class="nv"&gt;dates-long&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;returns the dates as&lt;/span&gt;
&lt;span class="s"&gt;long&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;data&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;ymd-formatter&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;formatters&lt;/span&gt; &lt;span class="ss"&gt;:year-month-day&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="nv"&gt;dates-str&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sc"&gt;\$&lt;/span&gt; &lt;span class="ss"&gt;:Date&lt;/span&gt; &lt;span class="nv"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;map &lt;/span&gt;&lt;span class="sc"&gt;\#&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;to-long&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;parse &lt;/span&gt;&lt;span class="nv"&gt;ymd-formatter&lt;/span&gt; &lt;span class="nv"&gt;%&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="nv"&gt;dates-str&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;span class="c1"&gt;;; no replace col func (def gdx-times (dates-long gdx)) (def gld-times&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;dates-long&lt;/span&gt; &lt;span class="nv"&gt;gld&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;view&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;time-series-plot&lt;/span&gt; &lt;span class="nv"&gt;gld-times&lt;/span&gt; &lt;span class="nv"&gt;gld-ac&lt;/span&gt; &lt;span class="ss"&gt;:x-label&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;Date&amp;quot;&lt;/span&gt; &lt;span class="ss"&gt;:y-label&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;GLD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;view&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;time-series-plot&lt;/span&gt; &lt;span class="nv"&gt;gdx-times&lt;/span&gt; &lt;span class="nv"&gt;gdx-ac&lt;/span&gt;
&lt;span class="ss"&gt;:x-label&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Date&amp;quot;&lt;/span&gt; &lt;span class="ss"&gt;:y-label&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;GDX&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Calculating the Pearson and the
Spearman's correlation coefficient are straightforward enough. It's just
a function call away. I am surprised to see Spearman's rho implemented
in Incanter already as its non-parametric statistics library is
practically non-existent. Yet another project to work on. However,
calculating the coefficients is only half the story. Where are the
p-values? That doesn't seem to be available for these functions. The
t-test function is a good example of what results I would like to see. A
third item to work on. &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;correlation&lt;/span&gt; &lt;span class="nv"&gt;gdx-ac&lt;/span&gt; &lt;span class="nv"&gt;gld-ac&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;; 0.7906494552829249 (spearmans-rho gdx-ac gld-ac) ; 0.7728859703262337&lt;/span&gt;
&lt;span class="c1"&gt;;; no p-value in col, like t-test (let [lm (linear-model gdx-ac gld-ac)]&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;doto &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;scatter-plot&lt;/span&gt; &lt;span class="nv"&gt;gld-ac&lt;/span&gt; &lt;span class="nv"&gt;gdx-ac&lt;/span&gt; &lt;span class="ss"&gt;:x-label&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;GLD&amp;quot;&lt;/span&gt; &lt;span class="ss"&gt;:y-label&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;GDX&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;add-lines&lt;/span&gt; &lt;span class="nv"&gt;gld-ac&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:fitted&lt;/span&gt; &lt;span class="nv"&gt;lm&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="nv"&gt;view&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;[caption id="attachment_5543" align="aligncenter" width="488" caption="GLD-GDX
scatter plot"]&lt;img alt="" src="http://www.quantisan.com/static/images/2011/06/incanter-chart-GLD-GDX.png" title="incanter-chart-GLD-GDX" /&gt;[/caption] Even though Incanter is still early in
its development, it is certainly a usable statistical platform offering
many of the basics. I look forward to learning more about it and
contributing to the project. Now, which of the listed problems should I
tackle first? P.S. My code embed seem to be mysteriously breaking my
code. As an alternative, the &lt;a href="https://gist.github.com/1047101"&gt;complete source&lt;/a&gt; is available on Gist.&lt;/p&gt;</summary><category term="clojure"></category><category term="Incanter"></category></entry></feed>