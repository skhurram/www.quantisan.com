<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="http://www.quantisan.com/theme/css/style.css">
    <link rel="stylesheet" type="text/css" href="http://www.quantisan.com/theme/css/pygments.css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:800,400,300|Inconsolata' rel='stylesheet' type='text/css'>
	<link href="http://www.quantisan.com/" type="application/atom+xml" rel="alternate" title="Quantitative Artisan ATOM Feed" />


        <title>Quantitative Artisan - clojure</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Paul Lam">
</head>

<body>
    <section id="navbar">
        <div class="user_meta">
            <h1 id="user"><a href="http://www.quantisan.com" class="">Paul Lam</a></h1>
            <h2>Data. Engineering. Startup.</h2>
        </div>
        <div class="nav-button">
            <ul>
                                    <li><a href="http://www.quantisan.com/about/">About</a></li>
                            <li><a href="mailto:paul@quantisan.com">Email</a></li>
                            <li><a href="http://www.twitter.com/Quantisan">Twitter</a></li>
                            <li><a href="http://www.github.com/Quantisan">Github</a></li>
                            <li><a href="http://www.linkedin.com/in/paullam">LinkedIn</a></li>
                            <li><a href="http://feeds.feedburner.com/Quantisan">Subscribe</a></li>
             </ul>
         </div>
     </section>

     <section id="sidebar">
        <img src="/images/profile_circle.png" id="logo" alt="logo">

        <div class="user_meta">
            <h1 id="user"><a href="http://www.quantisan.com" class="">Paul Lam</a></h1>
            <h2>Data. Engineering. Startup.</h2>
            <ul>
                        <li><a href="http://www.quantisan.com/about/">About</a></li>
                        <li><a href="mailto:paul@quantisan.com">Email</a></li>
                        <li><a href="http://www.twitter.com/Quantisan">Twitter</a></li>
                        <li><a href="http://www.github.com/Quantisan">Github</a></li>
                        <li><a href="http://www.linkedin.com/in/paullam">LinkedIn</a></li>
                        <li><a href="http://feeds.feedburner.com/Quantisan">Subscribe</a></li>
            </ul>
        </div>
        <footer>
            <address>
                Powered by <a href='http://docs.getpelican.com/en/latest/'>Pelican</a>,
                <a href='https://github.com/jamescooke/pelican-svbtle#readme'>theme info</a>.
            </address>
        </footer>
    </section>

    <section id="posts">
	
        <article class='listed'>
            <h1 class="title">
                <a href="http://www.quantisan.com/algorithmic-ownage/" rel='bookmark'>Algorithmic ownage</a>
            </h1>
            <div class="article-content"> <p>I felt good when I simplified one of my algorithms and sped it up 10
times. I felt so good that I even wrote an entire blog post about it
<a href="/eureka-moment-on-design-patterns-for-functional-programming/">patting myself on the back</a>. Then last week I got an email from Kevin
of <a href="http://keminglabs.com/">Keming Labs</a> suggesting a few alternatives.</p>
<div class="highlight"><pre><span class="c1">;;Three ways to count the number of occurrences in a collection</span>
<span class="c1">;; (&quot;orange&quot; &quot;bottle&quot; &quot;coke&quot; &quot;bottle&quot;) =&gt; [(&quot;bottle&quot; &quot;coke&quot; &quot;orange&quot;) (2 1 1)]</span>
<span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">c</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;orange&quot;</span> <span class="s">&quot;bottle&quot;</span> <span class="s">&quot;coke&quot;</span> <span class="s">&quot;bottle&quot;</span><span class="p">)]</span>

  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">counts</span> <span class="p">(</span><span class="nb">reduce </span><span class="o">#</span><span class="p">(</span><span class="nb">conj </span><span class="nv">%1</span> <span class="p">(</span><span class="nb">hash-map </span><span class="nv">%2</span> <span class="p">(</span><span class="nb">inc </span><span class="p">(</span><span class="nb">get </span><span class="nv">%1</span> <span class="nv">%2</span> <span class="mi">0</span><span class="p">))))</span>
                       <span class="p">{}</span> <span class="nv">c</span><span class="p">)]</span>
    <span class="p">[(</span><span class="nb">keys </span><span class="nv">counts</span><span class="p">)</span>
     <span class="p">(</span><span class="nb">vals </span><span class="nv">counts</span><span class="p">)])</span>


  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">l</span> <span class="p">(</span><span class="nb">for </span><span class="p">[[</span><span class="nv">k</span> <span class="nv">v</span><span class="p">]</span> <span class="p">(</span><span class="nf">group-by</span> <span class="nb">identity </span><span class="nv">c</span><span class="p">)]</span>
            <span class="p">[</span><span class="nv">k</span> <span class="p">(</span><span class="nb">count </span><span class="nv">v</span><span class="p">)])]</span>
    <span class="p">[(</span><span class="nb">map first </span><span class="nv">l</span><span class="p">)</span>
     <span class="p">(</span><span class="nb">map second </span><span class="nv">l</span><span class="p">)])</span>


  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">counts</span> <span class="p">(</span><span class="nb">apply merge-with </span><span class="nv">+</span>
                      <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">apply hash-map </span><span class="nv">%</span><span class="p">)</span>
                           <span class="p">(</span><span class="nf">partition</span> <span class="mi">2</span> <span class="p">(</span><span class="nb">interleave </span><span class="nv">c</span> <span class="p">(</span><span class="nb">repeat </span><span class="mi">1</span><span class="p">)))))]</span>
    <span class="p">[(</span><span class="nb">keys </span><span class="nv">counts</span><span class="p">)</span>
     <span class="p">(</span><span class="nb">vals </span><span class="nv">counts</span><span class="p">)]))</span>
</pre></div>


<p>First of all, his solutions looked much cleaner <a href="/eureka-moment-on-design-patterns-for-functional-programming/">than mine</a>. Then over
the weekend I was able to incorporate his 3 algorithms into my program.
I ran a few benchmarks and here are the average of 2 tests using a
dataset of 28,760 items.</p>
<ul>
<li>My algorithm. Elapsed time: 68372.026532 msecs.</li>
<li>Kevin's solution #1. Elapsed time: 156.940976 msecs.</li>
<li>Kevin's solution #2. Elapsed time: 60.165483 msecs.</li>
<li>Kevin's solution #3. Elapsed time: 296.162042 msecs.</li>
</ul>
<p>Total ownage. That's what I like about sharing my
work; once in a blue moon, a reader drops by and generously show
me how I can improve a solution 1,000 times! Now the ball is in my hands
to understand what he has done and improve myself. Collaborating and
learning, that's why I open source.</p>
<p>Update: I've done some more digging and it seems that one of the reasons for the drastic improvement in performance is due to the use of <a href="http://clojure.org/transients">transients</a> in the built-in functions. Lesson of the day, leverage the language's inherent optimization by staying with core data structures and functions as much as possible.</p> </div>
            <div class="abbr published">
                Posted  <a href='http://www.quantisan.com/algorithmic-ownage/' title='2011-11-06T17:37:00'>06 November 2011</a> in <a href="http://www.quantisan.com/category/computing/">computing</a>.              
            </div>
        </article>
        <article class='listed'>
            <h1 class="title">
                <a href="http://www.quantisan.com/eureka-moment-on-design-patterns-for-functional-programming/" rel='bookmark'>Eureka moment on design patterns for functional programming</a>
            </h1>
            <div class="article-content"> <p>Understanding design patterns for object-oriented programming made my
life easier as a Java programmer. So I have been looking for a
comparable book for functional programming ever since my sojourn into
this age-old paradigm. It looks as though <a href="http://stackoverflow.com/questions/2930277/functional-programming-equivalent-of-design-patterns-book">I'm not the only one
looking</a> too. But the thing is, I think I've just had a revelation of
sort.</p>
<p>There is one and only one guideline to designing functional
architectures -- Keep it simple. Simple as in keeping your functions
having a single purpose only. Simple as in work with the data directly and
don't conjure unnecessary intermediaries. Simple, as elaborated by Rich
Hickey in his talk, <a href="http://www.infoq.com/presentations/Simple-Made-Easy">Simple Made Easy</a>. Much of this is conveyed in Bloch's Effective Java:</p>
<div class="highlight"><pre><span class="n">item</span> <span class="err">\#</span><span class="mi">5</span> <span class="err">\–</span> <span class="n">Avoid</span> <span class="n">creating</span> <span class="n">unnecessary</span> <span class="n">objects</span>
<span class="n">item</span> <span class="err">\#</span><span class="mi">13</span> <span class="err">\–</span> <span class="n">minimize</span> <span class="n">accessibility</span> <span class="n">of</span> <span class="n">classes</span> <span class="n">and</span> <span class="n">members</span>
</pre></div>


<p>, for examples.</p>
<p>As <a href="http://stackoverflow.com/questions/2930277/functional-programming-equivalent-of-design-patterns-book/2930452#2930452">Majewski said in a stackoverflow reply</a> (Update 2013 – question no longer available on stackoverflow),</p>
<div class="highlight"><pre><span class="n">The</span> <span class="n">patterns</span> <span class="n">movement</span> <span class="n">started</span> <span class="n">because</span> <span class="n">object</span><span class="o">-</span><span class="n">oriented</span> <span class="n">programming</span> 
<span class="n">was</span> <span class="n">often</span> <span class="n">turning</span> <span class="n">into</span> <span class="n">spaghetti</span> <span class="n">objects</span> <span class="p">...</span> <span class="n">Functional</span> <span class="n">programming</span> 
<span class="n">is</span> <span class="n">a</span> <span class="k">restricted</span> <span class="n">style</span> <span class="n">of</span> <span class="n">programming</span><span class="p">,</span> <span class="n">so</span> <span class="n">it</span> <span class="n">didn</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">need</span> <span class="n">to</span> <span class="n">grow</span> <span class="n">a</span> <span class="n">set</span>
<span class="n">of</span> <span class="k">restricted</span> <span class="n">conventions</span> <span class="n">to</span> <span class="n">limit</span> <span class="n">the</span> <span class="n">chaos</span><span class="p">.</span>
</pre></div>


<p>As such, there is no design pattern book for functional programming. I didn't get that earlier this year. But something clicked recently. During the past few months, I've been doing some <a href="http://www.quantisan.com/ive-quit-my-day-job-and-moved-to-the-uk-to-do-this-full-time/">consulting and open source projects</a> solving algorithmic problems with Clojure.</p>
<p>One of the problems in a project that I was faced with this week is calculating the occurrence of each distinctive element within a list of elements. Say we have a list, <code>coll = ("orange", "bottle", "coke", "bottle")</code>. The output would be something like <code>[("orange", "bottle", "coke") (1 2 1)]</code> </p>
<p>This is my first solution.</p>
<div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">eval-decompose</span>
  <span class="p">[</span><span class="nv">coll</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">super-d</span>  <span class="p">(</span><span class="nb">distinct </span><span class="nv">coll</span><span class="p">)</span>
        <span class="nv">freqs</span>    <span class="p">(</span><span class="k">loop </span><span class="p">[</span><span class="nv">ps</span>  <span class="p">[]</span>
                        <span class="nv">d</span>   <span class="nv">super-d</span><span class="p">]</span>
                   <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">seq </span><span class="nv">d</span><span class="p">)</span>
                     <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">c</span>  <span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">filter </span><span class="p">(</span><span class="nb">partial = </span><span class="p">(</span><span class="nb">first </span><span class="nv">d</span><span class="p">))</span> <span class="nv">coll</span><span class="p">))]</span>
                       <span class="p">(</span><span class="nf">recur</span> <span class="p">(</span><span class="nb">conj </span><span class="nv">ps</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nb">rest </span><span class="nv">d</span><span class="p">)))</span>
                     <span class="nv">ps</span><span class="p">))]</span>
    <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">vector </span><span class="nv">%1</span> <span class="nv">%2</span><span class="p">)</span> <span class="nv">super-d</span> <span class="nv">freqs</span><span class="p">)))</span>
</pre></div>


<p>The specs are not exactly as I described but the concept remains. What I
did is to use tail calls (it's supposed to be fast, isn't it?) to
aggregate each counter to produce a vector of counts. Then I map each
pair of fragment with its corresponding count to generate a final output
collection. Sounds overly complicated, doesn't it?</p>
<p>This is the first warning of a bad functional design. For a collection of 30,000 items,
this function took 11 minutes to compute on my notebook. This looks like
a good place to exploit the parallel nature of this problem.</p>
<p>Specifically, the counting of each fragment is independent of other
fragments. Thus, there's no need for the program to wait for one
fragment to finish to process the next. I simplified the program to
remove this inherent assumption of procedural processing. Here is the
gist of the refactored code where each function only does one job. Since
the processing are modularised, I can parallelize the algorithm easily
with the use of pmap instead of map on the last line as shown below.</p>
<div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">match-count</span>
<span class="s">&quot; Given key, k, returns number of occurrences of k in collection, coll.</span>
<span class="s">&quot;</span>
  <span class="p">[</span><span class="nv">k</span> <span class="nv">coll</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">match?</span>  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">i</span> <span class="nv">x</span><span class="p">]</span>
                  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">k</span> <span class="nv">x</span><span class="p">)</span>   <span class="c1">;; closure on k</span>
                    <span class="p">(</span><span class="nb">inc </span><span class="nv">i</span><span class="p">)</span>
                    <span class="nv">i</span><span class="p">))]</span>
    <span class="p">(</span><span class="nb">reduce </span><span class="nv">match?</span> <span class="mi">0</span> <span class="nv">coll</span><span class="p">)))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">calc-counts</span>
<span class="s">&quot; Returns a list of counts for the occurrences of each key of keys, ks,</span>
<span class="s">  within the collection, coll.</span>
<span class="s">&quot;</span>
  <span class="p">[</span><span class="nv">ks</span> <span class="nv">coll</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">pmap</span> <span class="o">#</span><span class="p">(</span><span class="nf">match-count</span> <span class="nv">%</span> <span class="nv">coll</span><span class="p">)</span> <span class="nv">ks</span><span class="p">))</span>
</pre></div>


<p>I've split the first function into 3 functions (2 shown here). As Hickey
said in his talk, simplifying can often produce more, not less,
functions. Yet, the program is not only easier to read and runs in less
than a minute. An order of magnitude faster! There are still lots for me
to learn. I want to find more challenging projects to push my own
limits. But rather than solving arbitrary problems, I prefer to tackle
real-world challenges. So if you know of anyone that can benefit from
collaborating with a functional developer to build robust and scalable
software, please pass along <a href="mailto:paul@quantisan.com">my contact</a>.</p>
<p>Follow up: Kevin Lynagh showed me three better ways of doing this in a follow-up post – <a href="/algorithmic-ownage/">Algorithmimc ownage</a>. Humbled.</p> </div>
            <div class="abbr published">
                Posted  <a href='http://www.quantisan.com/eureka-moment-on-design-patterns-for-functional-programming/' title='2011-10-25T15:28:00'>25 October 2011</a> in <a href="http://www.quantisan.com/category/computing/">computing</a>.              
            </div>
        </article>
        <article class='listed'>
            <h1 class="title">
                <a href="http://www.quantisan.com/vector-algorithm-using-tree-composition/" rel='bookmark'>Vector algorithm using tree composition</a>
            </h1>
            <div class="article-content"> <p>Sniffed this trick from the Incanter source. Here's a demo of using tree
composition to calculate a 2-d Euclidean distance between two points.</p>
<div class="highlight"><pre><span class="p">(</span><span class="k">def </span><span class="nv">x</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span><span class="p">])</span> 
<span class="p">(</span><span class="k">def </span><span class="nv">y</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">5</span><span class="p">])</span> 
<span class="p">(</span><span class="kd">defn- </span><span class="nv">tree-comp-each</span> <span class="p">[</span><span class="nb">root </span><span class="nv">branch</span> <span class="o">&amp;</span> <span class="nv">leaves</span><span class="p">]</span>
    <span class="p">(</span><span class="nb">apply root </span><span class="p">(</span><span class="nb">map </span><span class="nv">branch</span> <span class="nv">leaves</span><span class="p">)))</span> 
<span class="p">(</span><span class="kd">defn </span><span class="nv">euclidean-distance</span> <span class="p">[</span><span class="nv">a</span> <span class="nv">b</span><span class="p">]</span>
    <span class="p">{</span><span class="ss">:pre</span> <span class="p">[(</span><span class="nb">= </span><span class="p">(</span><span class="nb">count </span><span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nb">count </span><span class="nv">b</span><span class="p">))]}</span> 
    <span class="p">(</span><span class="nf">sqrt</span> <span class="p">(</span><span class="nb">apply </span><span class="nv">tree-comp-each</span> <span class="nb">+ </span>
                <span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nv">x</span> <span class="nv">y</span><span class="p">]]</span>
                    <span class="p">(</span><span class="nf">pow</span> <span class="p">(</span><span class="nb">- </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">2</span><span class="p">))</span> 
                <span class="p">(</span><span class="nb">map vector </span><span class="nv">a</span> <span class="nv">b</span><span class="p">))))</span>
</pre></div>


<p>I've only had exposures to tree traversal in the use of implementing searching and sorting
algorithms. This trick here definitely widened my eyes to the wonders of
functional programming. It's more than just being able to pass and
manipulate functions. I need to think like a tree.</p> </div>
            <div class="abbr published">
                Posted  <a href='http://www.quantisan.com/vector-algorithm-using-tree-composition/' title='2011-08-07T09:43:00'>07 August 2011</a> in <a href="http://www.quantisan.com/category/computing/">computing</a>.              
            </div>
        </article>
        <article class='listed'>
            <h1 class="title">
                <a href="http://www.quantisan.com/first-impression-of-incanter-usably-incomplete/" rel='bookmark'>First impression of Incanter: usably incomplete</a>
            </h1>
            <div class="article-content"> <p>Speaking out loud about my new favourite toys, Clojure (a functional
programming language) and Incanter (a R-like statistical platform built
on Clojure). My first impression is that Incanter is usable but it is
far from being polished like R since it is a new platform. I am using
the Gold Miners ETF (GDX) and Gold Trust (GLD) data from Yahoo Finance
as examples to perform a simple correlation test. Some Incanter
functions are rough on the edges and a lot is left to be desired. This
is a drastic contrast to R in which its plug-in modules are both
impressive and comprehensive. On the other hand, making things happen
with Clojure is ... fun. And that's a winner for me. Here's a walk
through of my first attempt using Incanter to analyse stocks data.
Figures 1 and 2 below are basic time series plot of GDX and GLD. I'll
need to study the Incanter source code to figure out how to plot
multiple time series on the same chart. Couldn't find it on a first
glimpse though. [caption id="attachment_5535" align="aligncenter"
width="488" caption="GDX"]<img alt="" src="http://www.quantisan.com/static/images/2011/06/incanter-chart-GDX.png" title="incanter-chart-GDX" />[/caption] [caption id="attachment_5536"
align="aligncenter" width="488" caption="GLD"]<img alt="" src="http://www.quantisan.com/static/images/2011/06/incanter-chart-GLD.png" title="incanter-chart-GLD" />[/caption] The
following looks like a lot of code just to plot two graphs. Most of the
boilerplate code is to coerce the Yahoo Finance CSV data to specifically
fit Incanter's time-series-plot function. I will wrap this into a
library later on.</p>
<div class="highlight"><pre><span class="p">(</span><span class="kd">ns </span><span class="nv">inc-sandbox.corr-demo</span> <span class="p">(</span><span class="ss">:require</span>
<span class="p">[</span><span class="nv">clojure.set</span> <span class="ss">:as</span> <span class="nv">set</span><span class="p">])</span> <span class="p">(</span><span class="ss">:use</span> <span class="p">(</span><span class="nf">incanter</span> <span class="nv">core</span> <span class="nv">stats</span> <span class="nv">charts</span> <span class="nv">io</span><span class="p">))</span> <span class="p">(</span><span class="ss">:require</span>
<span class="p">[</span><span class="nv">clj-time.core</span> <span class="ss">:as</span> <span class="nv">time</span><span class="p">])</span> <span class="p">(</span><span class="ss">:use</span> <span class="p">(</span><span class="nf">clj-time</span> <span class="p">[</span><span class="nv">format</span> <span class="ss">:only</span> <span class="p">(</span><span class="nf">formatter</span>
<span class="nv">formatters</span> <span class="nv">parse</span><span class="p">)]</span> <span class="p">[</span><span class="nv">coerce</span> <span class="ss">:only</span> <span class="p">(</span><span class="nf">to-long</span><span class="p">)])))</span> <span class="p">(</span><span class="kd">defn </span><span class="nv">sym-to-dataset</span>
<span class="s">&quot;returns a dataset read from a local CSV in &#39;./data/&#39; given a Yahoo</span>
<span class="s">Finance symbol name&quot;</span> <span class="p">[</span><span class="nv">yf-symbol</span><span class="p">]</span> <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">+data</span> <span class="s">&quot;./data/&quot;</span> <span class="nv">+csv</span> <span class="s">&quot;.csv&quot;</span>
<span class="nb">symbol </span><span class="p">(</span><span class="nf">.toUpperCase</span> <span class="nv">yf-symbol</span><span class="p">)</span> <span class="nv">filename</span> <span class="p">(</span><span class="nb">str </span><span class="nv">+data</span> <span class="nb">symbol </span><span class="nv">+csv</span><span class="p">)]</span> <span class="p">(</span><span class="nf">-</span><span class="sc">\&gt;</span>
<span class="p">(</span><span class="nf">read-dataset</span> <span class="nv">filename</span> <span class="ss">:header</span> <span class="nv">true</span><span class="p">)</span> <span class="p">(</span><span class="nf">col-names</span> <span class="p">[</span><span class="ss">:Date</span> <span class="ss">:Open</span> <span class="ss">:High</span> <span class="ss">:Low</span>
<span class="ss">:Close</span> <span class="ss">:Volume</span> <span class="ss">:Adj-Close</span><span class="p">]))))</span> <span class="p">(</span><span class="k">def </span><span class="nv">gdx</span> <span class="p">(</span><span class="nf">sym-to-dataset</span> <span class="s">&quot;GDX&quot;</span><span class="p">))</span> <span class="p">(</span><span class="k">def </span><span class="nv">gld</span>
<span class="p">(</span><span class="nf">sym-to-dataset</span> <span class="s">&quot;GLD&quot;</span><span class="p">))</span> <span class="p">(</span><span class="kd">defn </span><span class="nv">same-dates?</span> <span class="s">&quot;are two datasets covering the</span>
<span class="s">same time frame?&quot;</span> <span class="p">[</span><span class="nv">x</span> <span class="nv">y</span><span class="p">]</span> <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">x-dates</span> <span class="p">(</span><span class="nb">into </span><span class="sc">\#</span><span class="p">{}</span> <span class="p">(</span><span class="sc">\$</span> <span class="ss">:Date</span> <span class="nv">x</span><span class="p">))</span> <span class="nv">y-dates</span>
<span class="p">(</span><span class="nb">into </span><span class="sc">\#</span><span class="p">{}</span> <span class="p">(</span><span class="sc">\$</span> <span class="ss">:Date</span> <span class="nv">y</span><span class="p">))</span> <span class="nv">x-y</span> <span class="p">(</span><span class="nf">clojure.set/difference</span> <span class="nv">x-dates</span> <span class="nv">y-dates</span><span class="p">)</span>
<span class="nv">y-x</span> <span class="p">(</span><span class="nf">clojure.set/difference</span> <span class="nv">y-dates</span> <span class="nv">x-dates</span><span class="p">)]</span> <span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nf">empty?</span> <span class="nv">x-y</span><span class="p">)</span> <span class="p">(</span><span class="nf">empty?</span>
<span class="nv">y-x</span><span class="p">))))</span> <span class="p">(</span><span class="nf">same-dates?</span> <span class="nv">gdx</span> <span class="nv">gld</span><span class="p">)</span> <span class="c1">; true (def gdx-ac (\$ :Adj-Close gdx))</span>
<span class="p">(</span><span class="k">def </span><span class="nv">gld-ac</span> <span class="p">(</span><span class="sc">\$</span> <span class="ss">:Adj-Close</span> <span class="nv">gld</span><span class="p">))</span> <span class="p">(</span><span class="kd">defn </span><span class="nv">dates-long</span> <span class="s">&quot;returns the dates as</span>
<span class="s">long&quot;</span> <span class="p">[</span><span class="nv">data</span><span class="p">]</span> <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">ymd-formatter</span> <span class="p">(</span><span class="nf">formatters</span> <span class="ss">:year-month-day</span><span class="p">)</span> <span class="nv">dates-str</span>
<span class="p">(</span><span class="sc">\$</span> <span class="ss">:Date</span> <span class="nv">data</span><span class="p">)]</span> <span class="p">(</span><span class="nb">map </span><span class="sc">\#</span><span class="p">(</span><span class="nf">to-long</span> <span class="p">(</span><span class="nb">parse </span><span class="nv">ymd-formatter</span> <span class="nv">%</span><span class="p">))</span> <span class="nv">dates-str</span><span class="p">)))</span>
<span class="c1">;; no replace col func (def gdx-times (dates-long gdx)) (def gld-times</span>
<span class="p">(</span><span class="nf">dates-long</span> <span class="nv">gld</span><span class="p">))</span> <span class="p">(</span><span class="nf">view</span> <span class="p">(</span><span class="nf">time-series-plot</span> <span class="nv">gld-times</span> <span class="nv">gld-ac</span> <span class="ss">:x-label</span>
<span class="s">&quot;Date&quot;</span> <span class="ss">:y-label</span> <span class="s">&quot;GLD&quot;</span><span class="p">))</span> <span class="p">(</span><span class="nf">view</span> <span class="p">(</span><span class="nf">time-series-plot</span> <span class="nv">gdx-times</span> <span class="nv">gdx-ac</span>
<span class="ss">:x-label</span> <span class="s">&quot;Date&quot;</span> <span class="ss">:y-label</span> <span class="s">&quot;GDX&quot;</span><span class="p">))</span>
</pre></div>


<p>Calculating the Pearson and the
Spearman's correlation coefficient are straightforward enough. It's just
a function call away. I am surprised to see Spearman's rho implemented
in Incanter already as its non-parametric statistics library is
practically non-existent. Yet another project to work on. However,
calculating the coefficients is only half the story. Where are the
p-values? That doesn't seem to be available for these functions. The
t-test function is a good example of what results I would like to see. A
third item to work on. </p>
<div class="highlight"><pre> <span class="p">(</span><span class="nf">correlation</span> <span class="nv">gdx-ac</span> <span class="nv">gld-ac</span><span class="p">)</span>
<span class="c1">; 0.7906494552829249 (spearmans-rho gdx-ac gld-ac) ; 0.7728859703262337</span>
<span class="c1">;; no p-value in col, like t-test (let [lm (linear-model gdx-ac gld-ac)]</span>
<span class="p">(</span><span class="nb">doto </span><span class="p">(</span><span class="nf">scatter-plot</span> <span class="nv">gld-ac</span> <span class="nv">gdx-ac</span> <span class="ss">:x-label</span> <span class="s">&quot;GLD&quot;</span> <span class="ss">:y-label</span> <span class="s">&quot;GDX&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">add-lines</span> <span class="nv">gld-ac</span> <span class="p">(</span><span class="ss">:fitted</span> <span class="nv">lm</span><span class="p">))</span> <span class="nv">view</span><span class="p">))</span>
</pre></div>


<p>[caption id="attachment_5543" align="aligncenter" width="488" caption="GLD-GDX
scatter plot"]<img alt="" src="http://www.quantisan.com/static/images/2011/06/incanter-chart-GLD-GDX.png" title="incanter-chart-GLD-GDX" />[/caption] Even though Incanter is still early in
its development, it is certainly a usable statistical platform offering
many of the basics. I look forward to learning more about it and
contributing to the project. Now, which of the listed problems should I
tackle first? P.S. My code embed seem to be mysteriously breaking my
code. As an alternative, the <a href="https://gist.github.com/1047101">complete source</a> is available on Gist.</p> </div>
            <div class="abbr published">
                Posted  <a href='http://www.quantisan.com/first-impression-of-incanter-usably-incomplete/' title='2011-06-25T20:43:00'>25 June 2011</a> in <a href="http://www.quantisan.com/category/data-science/">data-science</a>.              
            </div>
        </article>
<p class="paginator">
			<a href="http://www.quantisan.com/tag/clojure//index.html" class="button_accent">&larr;&nbsp;&nbsp;&nbsp;newer</a>

</p>
    </section>

<script type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
	</script>
	<script type="text/javascript">
		try {
			var pageTracker = _gat._getTracker("UA-2047602-4");
			pageTracker._trackPageview();
		} catch(err) {}</script>
</body>
</html>