<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="http://www.quantisan.com/theme/css/style.css">
    <link rel="stylesheet" type="text/css" href="http://www.quantisan.com/theme/css/pygments.css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:800,400,300|Inconsolata' rel='stylesheet' type='text/css'>
	<link href="http://www.quantisan.com/" type="application/atom+xml" rel="alternate" title="Paul Lam ATOM Feed" />


    <link rel="author" href="https://plus.google.com/113032572695973588996"/>

    <title>Paul Lam - source code</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Paul Lam">

</head>

<body>
    <section id="navbar">
        <div class="user_meta">
            <h1 id="user"><a href="http://www.quantisan.com" class="">Paul Lam</a></h1>
            <h2>Data. Engineering. Startup.</h2>
        </div>
        <div class="nav-button">
            <ul>
                                    <li><a href="http://www.quantisan.com/about/">About</a></li>
                            <li><a href="mailto:paul@quantisan.com">Email</a></li>
                            <li><a href="http://www.twitter.com/Quantisan">Twitter</a></li>
                            <li><a href="http://www.github.com/Quantisan">Github</a></li>
                            <li><a href="http://www.linkedin.com/in/paullam">LinkedIn</a></li>
                            <li><a href="http://feeds.feedburner.com/Quantisan">Subscribe</a></li>
             </ul>
         </div>
     </section>

     <section id="sidebar">
        <img src="/images/profile_circle.png" id="logo" alt="logo">

        <div class="user_meta">
            <h1 id="user"><a href="http://www.quantisan.com" class="">Paul Lam</a></h1>
            <h2>Data. Engineering. Startup.</h2>
            <ul>
                        <li><a href="http://www.quantisan.com/about/">About</a></li>
                        <li><a href="mailto:paul@quantisan.com">Email</a></li>
                        <li><a href="http://www.twitter.com/Quantisan">Twitter</a></li>
                        <li><a href="http://www.github.com/Quantisan">Github</a></li>
                        <li><a href="http://www.linkedin.com/in/paullam">LinkedIn</a></li>
                        <li><a href="http://feeds.feedburner.com/Quantisan">Subscribe</a></li>
            </ul>
        </div>
        <footer>
            <address>
                Powered by <a href='http://docs.getpelican.com/en/latest/'>Pelican</a>,
                <a href='https://github.com/jamescooke/pelican-svbtle#readme'>theme info</a>.
            </address>
        </footer>
    </section>

    <section id="posts">
	
        <article class='listed'>
            <h1 class="title">
                <a href="http://www.quantisan.com/maximal-frustration-in-printing-and-parsing-milliseconds-in-r/" rel='bookmark'>Maximal frustration in printing and parsing milliseconds in R</a>
            </h1>
            <div class="article-content"> <p>I've just spent an absurd amount of time figuring out how to parse
millisecond times into R. (It's standard practice to timestamp tick data
with milliseconds timing in a flat data file.) Turns out that there are
two problems that I faced. One being that there is a almost-hidden,
footnote option in the <a href="http://stat.ethz.ch/R-manual/R-devel/library/base/html/strptime.html">strptime( ) function</a> (for converting
characters to POSIX) in which it describes using <code>format = "%H:%M%OS"</code>
instead of <code>"%H:%M:%S"</code> to parse fractional seconds. However, the second,
and what's actually the one that's wasted much my time, is the fact that
R <strong>ignores</strong> milliseconds in printing by default! For example, here's
an output for the POSIXct representation of the integer value
1286564400.</p>
<div class="highlight"><pre><span class="s">&quot;2010-10-08 15:00:00 EDT&quot;</span>
</pre></div>


<p>So even though I figured how to represent millisecond times in R a few
hours ago, I never knew I did it simply because R is not printing the
output that I wanted on screen every time I tried! After a couple hours
of searching, trying, and frustrating, here's the one-liner command that
solved my problem.</p>
<div class="highlight"><pre><span class="n">options</span><span class="p">(</span><span class="n">digits</span><span class="p">.</span><span class="n">secs</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>


<p>which changes the options of the display and thus I can see the
following output from the same input as above.</p>
<div class="highlight"><pre><span class="s">&quot;2010-10-08 15:00:00.344 EDT&quot;</span>
</pre></div>


<p>I guess that's why they say <a href="http://blog.revolutionanalytics.com/2010/06/learning-r.html">R has a steep learning curve</a>! Yes, it is
very powerful and flexible. But there are limited standards and the
documentations are all over the place because it's a mish mash of
user-contributed packages!</p> </div>
            <div class="abbr published">
                Posted  <a href='http://www.quantisan.com/maximal-frustration-in-printing-and-parsing-milliseconds-in-r/' title='2010-10-08T15:32:00'>08 October 2010</a> in <a href="http://www.quantisan.com/category/algorithmic-trading/">algorithmic-trading</a>.              
            </div>
        </article>
        <article class='listed'>
            <h1 class="title">
                <a href="http://www.quantisan.com/jforex-example-not-letting-profit-turn-to-losses-with-a-breakeven-stop/" rel='bookmark'>JForex Example: Not letting profit turn to losses with a breakeven stop</a>
            </h1>
            <div class="article-content"> <p>While the <a href="http://www.quantisan.com/jforex-example-dual-timeframe-moving-averages-setup/">dual-timeframe trading setup</a> and much of the algorithm in
my contest strategy are for competition only (read: not for use with
real money) as I've warned numerous times, some of the risk management
techniques used there are really what I use in real life. This being one
of them. There's a saying in trading that "never let profits turns into
losses." That is exactly the motivation behind this JForex code snippet.
The following source code are excerpts from my <a href="http://www.dukascopy.com/ibentry.php?ibref=1143/">Dukascopy</a> JForex
contest's <a href="http://www.quantisan.com/sixth-place-finish-in-the-dukascopy-jforex-july-strategy-contest/">July strategy</a>. The complete source code file is available
in that link. Back to this concept of not letting profits turn to
losses. This is a matter of balancing between giving room for your trade
to reach its potential and limiting your drawdown. If you're too
careful, you may find yourself being whipsawed out before a price move
can materialize. If you keep your leash too loose though, well, you may
watch your profits turn into losses. The way I intrepret the saying is
that once your trade is profitable enough, you shouldn't let it slip
back into a loss. I implement the above statement in my automated
strategy as follows. Note that everything goes in the onTick() method so
that it watches your position on every tick. The line numbers correspond
to the <a href="http://www.quantisan.com/sixth-place-finish-in-the-dukascopy-jforex-july-strategy-contest/">complete source code</a> of my automated strategy.
[java firstline="177"] boolean isLong; double open, stop, diff, newStop;
for (IOrder order : engine.getOrders(instrument)) { if (order.getState()
== IOrder.State.FILLED) { [/java] [java firstline="191"] isLong =
order.isLong(); open = order.getOpenPrice(); stop =
order.getStopLossPrice(); diff = (open - stop); // *********
BREAKEVEN *********************** if (isLong &amp;&amp;
diff > 0 &amp;&amp; tick.getBid() > (open + diff)) {
order.close(roundLot(order.getAmount() * beRatio)); // close a portion
newStop = open + instrument.getPipValue() * LOCKPIP;
order.setStopLossPrice(newStop); print(order.getLabel() + ": Moved STOP
to breakeven"); } else if (!isLong &amp;&amp; diff \&lt; 0 &amp;&amp; tick.getAsk() \&lt;
(open + diff)) { order.close(roundLot(order.getAmount() * beRatio));
newStop = open - (instrument.getPipValue() * LOCKPIP);
order.setStopLossPrice(newStop); print(order.getLabel() + ": Moved STOP
to breakeven"); } [/java] What this does is that it will partially exit
a position and move the stop to breakeven once the price is
equidistantly positive from your initial stop loss. For example, if my
stop loss is 100 pips, then once the position is 100 pips <em>in profit</em>,
it will exit partially and set the new stop to breakeven. Update: This
is now integrated into the <a href="http://www.quantisan.com/jfutil-an-open-source-jforex-utilities-library/">JFUtil open source project</a>.</p> </div>
            <div class="abbr published">
                Posted  <a href='http://www.quantisan.com/jforex-example-not-letting-profit-turn-to-losses-with-a-breakeven-stop/' title='2010-08-11T13:11:00'>11 August 2010</a> in <a href="http://www.quantisan.com/category/algorithmic-trading/">algorithmic-trading</a>.              
            </div>
        </article>
        <article class='listed'>
            <h1 class="title">
                <a href="http://www.quantisan.com/jforex-example-multiple-time-frame-strategy/" rel='bookmark'>JForex Example:  Multiple-time frame strategy</a>
            </h1>
            <div class="article-content"> <p>The key to my July JForex strategy is the use of multiple time frames.
As Dr. Alexander Elder demonstrates in his famous book, <em>Trading For A
Living</em>, a proper technical analysis should at least consider time
frames five-times faster and slower than the one in which you trade. For
example, if you trade on a 30 minute chart, the one faster is 30/5 = 6
minutes, which can be rounded as the five-minute chart. And the one
slower would be 30 * 5 = 150 minutes. The closest standard time frame
of which is a 4-hour chart.</p>
<p>For <a href="http://www.quantisan.com/sixth-place-finish-in-the-dukascopy-jforex-july-strategy-contest/">my July JForex strategy</a>, it trades
on the 30 minute chart and monitor the 4-hour chart in addition to the
30-minute chart. The strategy doesn't make use of a faster time frame
for simplicity. This is surprisingly easy to do in <a href="http://www.dukascopy.com/ibentry.php?ibref=1143/">Dukascopy</a>'s
JForex API.</p>
<p>Referring to lines 81 to 87 of <a href="http://www.quantisan.com/sixth-place-finish-in-the-dukascopy-jforex-july-strategy-contest/">my strategy source code</a>. </p>
<div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="n">period</span> <span class="o">==</span> <span class="n">PERIODINT</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">setSentiment</span><span class="o">(</span><span class="n">instrument</span><span class="o">,</span> <span class="n">bidBar</span><span class="o">,</span> <span class="n">askBar</span><span class="o">);</span> 
    <span class="k">return</span><span class="o">;</span>
<span class="o">}</span> 
<span class="k">if</span> <span class="o">(</span><span class="n">period</span> <span class="o">!=</span> <span class="n">PERIODSHR</span><span class="o">)</span> <span class="k">return</span><span class="o">;</span> <span class="c1">// skip all other periods</span>
</pre></div>


<p>This chunk of code
appears in the onBar() method. Since onBar() is called at the beginning
of every price bar across all possible standard periods (from tick to
weekly), it's just a matter of filtering out the redundant periods
and/or catching the method when the period is correct. I have done both
in the sample code. Line 81 is to catch the longer period, <code>PERIODINT = Period.FOUR\_HOURS</code> (line 54, not shown), in an <code>if</code> statement block. It
calls my function <code>setSentiment()</code> and exits <code>onBar()</code> with the <code>return</code>,
skipping everything in onBar() afterward. Line 87 is to skip all other
periods that I'm not using. I could have used <code>if (period == PERIODSHR)</code>
and put everything in an <code>if</code> block as in lines 81-85. But since the
strategy is doing a lot more work in <code>PERIODSHR</code>, there would be a lot of
codes in that IF block. So I am doing the reverse for the same result
but simpler-looking codes. With this cleared, I can go over my <a href="http://www.quantisan.com/jforex-example-dual-timeframe-moving-averages-setup/">dual
moving average entry signal setup</a> in the next post later this week.</p> </div>
            <div class="abbr published">
                Posted  <a href='http://www.quantisan.com/jforex-example-multiple-time-frame-strategy/' title='2010-08-04T06:30:00'>04 August 2010</a> in <a href="http://www.quantisan.com/category/algorithmic-trading/">algorithmic-trading</a>.              
            </div>
        </article>
        <article class='listed'>
            <h1 class="title">
                <a href="http://www.quantisan.com/jforex-stopmananger-1-0/" rel='bookmark'>JForex StopManager 1.0</a>
            </h1>
            <div class="article-content"> <p>I am building my real JForex automated trading system one feature at a
time. The idea is to automate some of my most fundamental trading
techniques on JForex so that I can trade forex semi-automatically on
<a href="http://www.dukascopy.com/ibentry.php?ibref=1143/">Dukascopy</a>. I am starting off here with a simple stop management
strategy. In a nutshell, once the market price moves in your favour
equidistant from your original stop loss, this strategy moves the stop
to breakeven. For example, if I go long EURUSD at 1.3500 with a stop at
1.3400 (100 pips stop). Then if the price breaks above 1.3600 (100 pips
profit), the strategy moves the stop to breakeven. This is a simplistic
implementation of the saying that "never let profits turn into losses".
You can <a href="http://dl.dropbox.com/u/6028806/StopManager.java">download the source code here</a> and the <a href="http://dl.dropbox.com/u/6028806/StopManager.jfx">executable strategy
here</a>. Note that these files are made available through <a href="https://www.dropbox.com/referrals/NTYwMjg4MDY5/">Dropbox</a>.
Update: This logic is now integrated into the <a href="http://www.quantisan.com/jfutil-an-open-source-jforex-utilities-library/">JFUtil open source
project</a>. You can also see <a href="http://www.quantisan.com/tag/jforex/">a list of my latest JForex articles
here</a>. [java] /* StopManager.java version 1.0 Copyright 2010
Quantisan.com Move stops to breakeven when equidistance to original stop
loss */ package jforex; import com.dukascopy.api.*; public class
StopManager implements IStrategy { private IEngine engine; private
IConsole console; private IContext context; @Configurable("Lock-in Pips
for Breakeven") public int lockPip = 3; @Configurable("Move stop to
breakeven?") public boolean moveBE = true; public void onStart(IContext
context) throws JFException { this.engine = context.getEngine();
this.console = context.getConsole(); this.context = context; } public
void onAccount(IAccount account) throws JFException { } public void
onMessage(IMessage message) throws JFException { } public void onStop()
throws JFException { } public void onTick(Instrument instrument, ITick
tick) throws JFException { for (IOrder order :
engine.getOrders(instrument)) { if (order.getState() ==
IOrder.State.FILLED) { boolean isLong; double open, stop, diff, newStop;
String label = order.getLabel(); IChart chart; isLong = order.isLong();
open = order.getOpenPrice(); stop = order.getStopLossPrice(); diff =
open - stop; // stop loss distance if (isLong) { // long side order if
(moveBE &amp;&amp; diff > 0 &amp;&amp; tick.getBid() > (open + diff)) { // make it
breakeven trade + lock in a few pips newStop = open +
instrument.getPipValue() * lockPip; order.setStopLossPrice(newStop);
console.getOut().println(label + ": Moved stop to breakeven"); chart =
this.context.getChart(instrument); chart.draw(label + "_BE",
IChart.Type.SIGNAL_UP, tick.getTime(), newStop); } } else { // short
side order // Move to breakeven if (moveBE &amp;&amp; diff \&lt; 0 &amp;&amp; tick.getAsk()
\&lt; (open + diff)) { // diff is negative // make it breakeven trade +
lock in a few pips newStop = open - (instrument.getPipValue() *
lockPip); order.setStopLossPrice(newStop);
console.getOut().println(label + ": Moved stop to breakeven"); chart =
this.context.getChart(instrument); chart.draw(label + "_BE",
IChart.Type.SIGNAL_DOWN, tick.getTime(), newStop); } } } } } public
void onBar(Instrument instrument, Period period, IBar askBar, IBar
bidBar) throws JFException { } } [/java]</p> </div>
            <div class="abbr published">
                Posted  <a href='http://www.quantisan.com/jforex-stopmananger-1-0/' title='2010-04-12T20:39:00'>12 April 2010</a> in <a href="http://www.quantisan.com/category/algorithmic-trading/">algorithmic-trading</a>.              
            </div>
        </article>
<p class="paginator">
			<a href="http://www.quantisan.com/tag/source code//index.html" class="button_accent">&larr;&nbsp;&nbsp;&nbsp;newer</a>

                    <a href="http://www.quantisan.com/tag/source code//index3.html" class="button_accent" style="position: absolute; right: 0;">continue&nbsp;&nbsp;&nbsp;&rarr;</a>
</p>
    </section>

<script type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
	</script>
	<script type="text/javascript">
		try {
			var pageTracker = _gat._getTracker("UA-2047602-4");
			pageTracker._trackPageview();
		} catch(err) {}</script>
</body>
</html>