<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="http://www.quantisan.com/theme/css/style.css">
    <link rel="stylesheet" type="text/css" href="http://www.quantisan.com/theme/css/pygments.css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:800,400,300|Inconsolata' rel='stylesheet' type='text/css'>
	<link href="http://www.quantisan.com/" type="application/atom+xml" rel="alternate" title="Paul Lam ATOM Feed" />


        <title>Recommendation discovery via graph traversal - Paul Lam</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Paul Lam">
</head>

<body>
    <section id="navbar">
        <div class="user_meta">
            <h1 id="user"><a href="http://www.quantisan.com" class="">Paul Lam</a></h1>
            <h2>Data. Engineering. Startup.</h2>
        </div>
        <div class="nav-button">
            <ul>
                                    <li><a href="http://www.quantisan.com/about/">About</a></li>
                            <li><a href="mailto:paul@quantisan.com">Email</a></li>
                            <li><a href="http://www.twitter.com/Quantisan">Twitter</a></li>
                            <li><a href="http://www.github.com/Quantisan">Github</a></li>
                            <li><a href="http://www.linkedin.com/in/paullam">LinkedIn</a></li>
                            <li><a href="http://feeds.feedburner.com/Quantisan">Subscribe</a></li>
             </ul>
         </div>
     </section>

     <section id="sidebar">
        <img src="/images/profile_circle.png" id="logo" alt="logo">

        <div class="user_meta">
            <h1 id="user"><a href="http://www.quantisan.com" class="">Paul Lam</a></h1>
            <h2>Data. Engineering. Startup.</h2>
            <ul>
                        <li><a href="http://www.quantisan.com/about/">About</a></li>
                        <li><a href="mailto:paul@quantisan.com">Email</a></li>
                        <li><a href="http://www.twitter.com/Quantisan">Twitter</a></li>
                        <li><a href="http://www.github.com/Quantisan">Github</a></li>
                        <li><a href="http://www.linkedin.com/in/paullam">LinkedIn</a></li>
                        <li><a href="http://feeds.feedburner.com/Quantisan">Subscribe</a></li>
            </ul>
        </div>
        <footer>
            <address>
                Powered by <a href='http://docs.getpelican.com/en/latest/'>Pelican</a>,
                <a href='https://github.com/jamescooke/pelican-svbtle#readme'>theme info</a>.
            </address>
        </footer>
    </section>

    <section id="posts">
<article>
    <h1 class="title">
        <a href="http://www.quantisan.com/recommendation-discovery-via-graph-traversal/" rel="bookmark">Recommendation discovery via graph traversal</a>
    </h1>

    <div class='article-content'>
        <p>I am quite excited about graph computing these days. It represents relational data such as customer behaviour naturally and otherwise complicated problems break down to simple pattern matching algorithm. Take recommendation system, for example. One way to do it is by machine learning as <a href="http://en.wikipedia.org/wiki/Recommender_system">Wikipedia suggests</a>. But if we represent the data in a property graph, a simplistic solution surfaces intuitively. </p>
<p>Picture this. If Bob likes item A; Cathy likes both item A and item B; then we can make the commutative link of item B for Bob.</p>
<p>Let's try it out in <a href="http://www.neo4j.org">Neo4j</a> using <a href="http://console.neo4j.org/?id=2096v6">this pre-built web console example</a>. You should see this graph with 4 person and 5 food items.</p>
<p><img alt="simple graph" src="/static/images/2012/simple_graph.png" /></p>
<p>Using this <a href="http://docs.neo4j.org/chunked/milestone/cypher-query-lang.html">Cypher query</a>, we get a list of all users and what food they like.</p>
<div class="highlight"><pre><span class="n">START</span>   <span class="n">user</span> <span class="o">=</span> <span class="n">node</span><span class="o">:</span><span class="n">node_auto_index</span><span class="p">(</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;user&quot;</span><span class="p">)</span> 
<span class="n">MATCH</span>   <span class="n">person</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">IS_A</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">user</span><span class="p">,</span> <span class="n">person</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">LIKE</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">x</span>
<span class="n">RETURN</span>  <span class="n">person</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">.</span><span class="n">name</span>
</pre></div>


<p>The second line is where we <code>match</code> the pattern that <code>person is a user</code> and that <code>person like x</code>. This query reads almost like the question which we want to ask.</p>
<p>We return all the person and those food they like, <code>x</code>:</p>
<div class="highlight"><pre><span class="o">+------------------------+</span>
<span class="o">|</span> <span class="n">person</span><span class="p">.</span><span class="n">name</span> <span class="o">|</span> <span class="n">x</span><span class="p">.</span><span class="n">name</span>   <span class="o">|</span>
<span class="o">+------------------------+</span>
<span class="o">|</span> <span class="s">&quot;Andy&quot;</span>      <span class="o">|</span> <span class="s">&quot;apple&quot;</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Andy&quot;</span>      <span class="o">|</span> <span class="s">&quot;orange&quot;</span> <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Andy&quot;</span>      <span class="o">|</span> <span class="s">&quot;bread&quot;</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Bob&quot;</span>       <span class="o">|</span> <span class="s">&quot;apple&quot;</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Bob&quot;</span>       <span class="o">|</span> <span class="s">&quot;bread&quot;</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Cat&quot;</span>       <span class="o">|</span> <span class="s">&quot;apple&quot;</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Cat&quot;</span>       <span class="o">|</span> <span class="s">&quot;orange&quot;</span> <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Cat&quot;</span>       <span class="o">|</span> <span class="s">&quot;bread&quot;</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Cat&quot;</span>       <span class="o">|</span> <span class="s">&quot;fish&quot;</span>   <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Doug&quot;</span>      <span class="o">|</span> <span class="s">&quot;apple&quot;</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Doug&quot;</span>      <span class="o">|</span> <span class="s">&quot;orange&quot;</span> <span class="o">|</span>
<span class="o">+------------------------+</span>
</pre></div>


<p>Taking this a step further, we can find all the top common <code>x</code> and <code>y</code> that people like together in the above graph.</p>
<div class="highlight"><pre>START   food <span class="o">=</span> node<span class="o">:</span>node_auto_index<span class="p">(</span>type <span class="o">=</span> <span class="s">&quot;food&quot;</span><span class="p">),</span> user <span class="o">=</span> node<span class="o">:</span>node_auto_index<span class="p">(</span>type <span class="o">=</span> <span class="s">&quot;user&quot;</span><span class="p">)</span> 
MATCH   food<span class="o">&lt;-</span><span class="p">[</span><span class="o">:</span>IS_A<span class="p">]</span><span class="o">-</span>x<span class="o">&lt;-</span><span class="p">[</span><span class="o">:</span>LIKE<span class="p">]</span><span class="o">-</span>person<span class="o">-</span><span class="p">[</span><span class="o">:</span>IS_A<span class="p">]</span><span class="o">-&gt;</span>user<span class="p">,</span>
        person<span class="o">-</span><span class="p">[</span><span class="o">:</span>LIKE<span class="p">]</span><span class="o">-&gt;</span>y<span class="o">-</span><span class="p">[</span><span class="o">:</span>IS_A<span class="p">]</span><span class="o">-&gt;</span>food
WHERE   NOT x <span class="o">=</span> y
RETURN  x.name<span class="p">,</span> y.name<span class="p">,</span> count<span class="p">(</span><span class="o">*</span><span class="p">)</span> as cnt 
ORDER BY cnt DESC 
LIMIT <span class="m">10</span><span class="p">;</span>
</pre></div>


<p>Resulting in:</p>
<div class="highlight"><pre><span class="o">+---------------------------+</span>
<span class="o">|</span> <span class="n">x</span><span class="p">.</span><span class="n">name</span>   <span class="o">|</span> <span class="n">y</span><span class="p">.</span><span class="n">name</span>   <span class="o">|</span> <span class="n">cnt</span> <span class="o">|</span>
<span class="o">+---------------------------+</span>
<span class="o">|</span> <span class="s">&quot;apple&quot;</span>  <span class="o">|</span> <span class="s">&quot;orange&quot;</span> <span class="o">|</span> <span class="mi">3</span>   <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;apple&quot;</span>  <span class="o">|</span> <span class="s">&quot;bread&quot;</span>  <span class="o">|</span> <span class="mi">3</span>   <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;orange&quot;</span> <span class="o">|</span> <span class="s">&quot;apple&quot;</span>  <span class="o">|</span> <span class="mi">3</span>   <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;bread&quot;</span>  <span class="o">|</span> <span class="s">&quot;apple&quot;</span>  <span class="o">|</span> <span class="mi">3</span>   <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;bread&quot;</span>  <span class="o">|</span> <span class="s">&quot;orange&quot;</span> <span class="o">|</span> <span class="mi">2</span>   <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;orange&quot;</span> <span class="o">|</span> <span class="s">&quot;bread&quot;</span>  <span class="o">|</span> <span class="mi">2</span>   <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;fish&quot;</span>   <span class="o">|</span> <span class="s">&quot;apple&quot;</span>  <span class="o">|</span> <span class="mi">1</span>   <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;fish&quot;</span>   <span class="o">|</span> <span class="s">&quot;bread&quot;</span>  <span class="o">|</span> <span class="mi">1</span>   <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;apple&quot;</span>  <span class="o">|</span> <span class="s">&quot;fish&quot;</span>   <span class="o">|</span> <span class="mi">1</span>   <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;bread&quot;</span>  <span class="o">|</span> <span class="s">&quot;fish&quot;</span>   <span class="o">|</span> <span class="mi">1</span>   <span class="o">|</span>
<span class="o">+---------------------------+</span>
</pre></div>


<p>So we find that a lot uf users that likes apple also likes orange or bread. We can then pick out all the people that likes <code>apple</code> but not <code>orange</code> yet to suggest (read: spam) <code>orange</code> to them.</p>
<div class="highlight"><pre><span class="n">START</span>   <span class="n">apple</span> <span class="o">=</span> <span class="n">node</span><span class="o">:</span><span class="n">node_auto_index</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;apple&quot;</span><span class="p">),</span> <span class="n">orange</span> <span class="o">=</span> <span class="n">node</span><span class="o">:</span><span class="n">node_auto_index</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;orange&quot;</span><span class="p">)</span>
<span class="n">MATCH</span>   <span class="n">person</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">LIKE</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">apple</span>
<span class="n">WHERE</span>   <span class="n">NOT</span><span class="p">(</span><span class="n">person</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">LIKE</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">orange</span><span class="p">)</span>
<span class="n">RETURN</span>  <span class="n">person</span><span class="p">.</span><span class="n">name</span>

<span class="o">+-------------+</span>
<span class="o">|</span> <span class="n">person</span><span class="p">.</span><span class="n">name</span> <span class="o">|</span>
<span class="o">+-------------+</span>
<span class="o">|</span> <span class="s">&quot;Bob&quot;</span>       <span class="o">|</span>
<span class="o">+-------------+</span>
</pre></div>


<p>Easy, yes?</p>
    </div>

    <div class='post-footer'>
        <div class='share-footer'>
            <div id='dated' class="abbr published" title='2012-11-14T22:31:00'>
                Posted 14 November 2012
            </div>

<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
<a class="addthis_button_tweet"></a>
<a class="addthis_button_pinterest_pinit"></a>
<a class="addthis_counter addthis_pill_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=quantisan"></script>
<!-- AddThis Button END -->
 
        </div>

        <div id="article_meta">
            Category:
            <a href="http://www.quantisan.com/category/data-science/">data-science</a>
            <br />Tags:
            <a href="http://www.quantisan.com/tag/graph computing/">graph computing</a>
            <a href="http://www.quantisan.com/tag/recommendation system/">recommendation system</a>
            <a href="http://www.quantisan.com/tag/neo4j/">neo4j</a>
            <a href="http://www.quantisan.com/tag/cypher/">cypher</a>
        </div>


    </div>
</article>

<footer>
    <a href="http://www.quantisan.com/" class="button_accent">&larr;&nbsp;&nbsp;&nbsp;Back to blog</a>
</footer>

<div id="comments">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
    var disqus_identifier = "recommendation-discovery-via-graph-traversal/";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://quantisan-blog.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view <a href="http://disqus.com/?ref_noscript">comments</a>.</noscript>
</div>
    </section>

<script type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
	</script>
	<script type="text/javascript">
		try {
			var pageTracker = _gat._getTracker("UA-2047602-4");
			pageTracker._trackPageview();
		} catch(err) {}</script>
</body>
</html>