<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="http://www.quantisan.com/theme/css/style.css"> 
    <link rel="stylesheet" type="text/css" href="http://www.quantisan.com/theme/css/pygments.css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:800,400,300|Inconsolata' rel='stylesheet' type='text/css'>
	<link href="http://www.quantisan.com/" type="application/atom+xml" rel="alternate" title="Quantitative Artisan ATOM Feed" />


        <title>Dissecting a JForex strategy -- MA_Play.java - Quantitative Artisan</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Paul Lam">
</head>

<body>
    <section id="navbar">
        <div class="user_meta">
            <h1 id="user"><a href="http://www.quantisan.com" class="">Paul Lam</a></h1>
            <h2>Data. Engineering. Startup.</h2>
        </div>
        <div class="nav-button">
            <ul>
                                    <li><a href="http://www.quantisan.com/about/">About</a></li>
                            <li><a href="mailto:paul@quantisan.com">Email</a></li>
                            <li><a href="http://www.twitter.com/Quantisan">Twitter</a></li>
                            <li><a href="http://www.github.com/Quantisan">Github</a></li>
                            <li><a href="http://www.linkedin.com/in/paullam">LinkedIn</a></li>
                            <li><a href="http://feeds.feedburner.com/Quantisan">Subscribe</a></li>
             </ul>
         </div>
     </section>

     <section id="sidebar">
        <div class="user_meta">
            <h1 id="user"><a href="http://www.quantisan.com" class="">Paul Lam</a></h1>
            <h2>Data. Engineering. Startup.</h2>
            <ul>
                        <li><a href="http://www.quantisan.com/about/">About</a></li>
                        <li><a href="mailto:paul@quantisan.com">Email</a></li>
                        <li><a href="http://www.twitter.com/Quantisan">Twitter</a></li>
                        <li><a href="http://www.github.com/Quantisan">Github</a></li>
                        <li><a href="http://www.linkedin.com/in/paullam">LinkedIn</a></li>
                        <li><a href="http://feeds.feedburner.com/Quantisan">Subscribe</a></li>
            </ul>
        </div>
        <footer>
            <address>
                Powered by <a href='http://docs.getpelican.com/en/latest/'>Pelican</a>,
                <a href='https://github.com/jamescooke/pelican-svbtle#readme'>theme info</a>.
            </address>
        </footer>
    </section>

    <section id="posts">
<article>
    <h1 class="title">
        <a href="http://www.quantisan.com/dissecting-a-jforex-strategy-ma_play-java/" rel="bookmark">Dissecting a JForex strategy -- MA_Play.java</a>
    </h1>

    <div class='article-content'>
        <p>Having studied the anatomy of an empty JForex strategy (<a href="http://www.quantisan.com/anatomy-of-a-jforex-strategy-part-1/">Part 1</a> and
<a href="http://www.quantisan.com/anatomy-of-a-jforex-strategy-part-2/">Part 2</a>), it's time to dissect a working one. MA_Play is the
strategy that is included with every JForex API download as a
demonstration. You can find the complete source code of this strategy in
/src/singlejartest/ in the <a href="http://www.dukascopy.com/swiss/english/forex/jforex/library/">JForex API zipped package</a>. Recall that
the first Interface method which runs at the start of the strategy is
onStart. The onStart method of MA_Play is reproduced below. </p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStart</span><span class="o">(</span><span class="n">IContext</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JFException</span> <span class="o">{</span> 
    <span class="n">engine</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getEngine</span><span class="o">();</span> 
    <span class="n">indicators</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getIndicators</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">console</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getConsole</span><span class="o">();</span>
    <span class="n">console</span><span class="o">.</span><span class="na">getOut</span><span class="o">().</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Started&quot;</span><span class="o">);</span> 
<span class="o">}</span>
</pre></div>


<p>The variables <code>engine</code>, <code>indicators</code>, and <code>console</code> are <em>fields</em> of the MA_Play class. They are
global variables within the class. What lines 42--44 do is to save the
<a href="http://www.dukascopy.com/wiki/index.php?title=IEngine">IEngine</a>, <a href="http://www.dukascopy.com/wiki/index.php?title=IIndicators">IIndicators</a>, and <a href="http://www.dukascopy.com/wiki/index.php?title=IConsole">IConsole</a> objects for later use.</p>
<p>The last line of onStart, line 45, is merely to <a href="http://www.dukascopy.com/wiki/index.php?title=Console">print a message on your
JForex program console</a> to notify the user that the strategy has
started.</p>
<p>Once onStart is finished processing, the server is likely to
call onTick if a market tick arrives. If it's not during market hours,
then there's no tick and some other event might happen instead of
onTick. Think of the methods as events rather than a linear process. You
program your JForex strategy according to what you want to do with each
of the six IStrategy Interface event. </p>
<p>For this particular strategy, the
programmer decides to implement their strategy at the tick level. As
such, much of the trading algorithm resides in onTick for MA_Play. Note
that this is a design choice, you can use onBar if you want your
strategy to <a href="http://www.quantisan.com/anatomy-of-a-jforex-strategy-part-2/">process at the bar level</a> (or you can use both
onTick and onBar).</p>
<p>Here's the source code for onTick in MA_Play. </p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onTick</span><span class="o">(</span><span class="n">Instrument</span> <span class="n">instrument</span><span class="o">,</span> <span class="n">ITick</span> <span class="n">tick</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JFException</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">ma1</span><span class="o">[</span><span class="n">instrument</span><span class="o">.</span><span class="na">ordinal</span><span class="o">()]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ma1</span><span class="o">[</span><span class="n">instrument</span><span class="o">.</span><span class="na">ordinal</span><span class="o">()]</span> <span class="o">=</span> <span class="n">indicators</span><span class="o">.</span><span class="na">ema</span><span class="o">(</span><span class="n">instrument</span><span class="o">,</span> 
            <span class="n">Period</span><span class="o">.</span><span class="na">TEN_SECS</span><span class="o">,</span> 
            <span class="n">OfferSide</span><span class="o">.</span><span class="na">BID</span><span class="o">,</span> 
            <span class="n">IIndicators</span><span class="o">.</span><span class="na">AppliedPrice</span><span class="o">.</span><span class="na">MEDIAN_PRICE</span><span class="o">,</span> 
            <span class="mi">14</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kt">double</span> <span class="n">ma0</span> <span class="o">=</span> <span class="n">indicators</span><span class="o">.</span><span class="na">ema</span><span class="o">(</span><span class="n">instrument</span><span class="o">,</span> <span class="n">Period</span><span class="o">.</span><span class="na">TEN_SECS</span><span class="o">,</span> <span class="n">OfferSide</span><span class="o">.</span><span class="na">BID</span><span class="o">,</span> <span class="n">IIndicators</span><span class="o">.</span><span class="na">AppliedPrice</span><span class="o">.</span><span class="na">MEDIAN_PRICE</span><span class="o">,</span> <span class="mi">14</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">ma0</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">ma1</span><span class="o">[</span><span class="n">instrument</span><span class="o">.</span><span class="na">ordinal</span><span class="o">()]</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ma1</span><span class="o">[</span><span class="n">instrument</span><span class="o">.</span><span class="na">ordinal</span><span class="o">()]</span> <span class="o">=</span> <span class="n">ma0</span><span class="o">;</span>
        <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kt">double</span> <span class="n">diff</span> <span class="o">=</span> <span class="o">(</span><span class="n">ma1</span><span class="o">[</span><span class="n">instrument</span><span class="o">.</span><span class="na">ordinal</span><span class="o">()]</span> <span class="o">-</span> <span class="n">ma0</span><span class="o">)</span> <span class="o">/</span> <span class="o">(</span><span class="n">instrument</span><span class="o">.</span><span class="na">getPipValue</span><span class="o">());</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">positionsTotal</span><span class="o">(</span><span class="n">instrument</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">engine</span><span class="o">.</span><span class="na">submitOrder</span><span class="o">(</span><span class="n">getLabel</span><span class="o">(</span><span class="n">instrument</span><span class="o">),</span> <span class="n">instrument</span><span class="o">,</span> <span class="n">IEngine</span><span class="o">.</span><span class="na">OrderCommand</span><span class="o">.</span><span class="na">SELL</span><span class="o">,</span> <span class="mf">0.001</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">tick</span><span class="o">.</span><span class="na">getAsk</span><span class="o">()</span>
                    <span class="o">+</span> <span class="n">instrument</span><span class="o">.</span><span class="na">getPipValue</span><span class="o">()</span> <span class="o">*</span> <span class="mi">10</span><span class="o">,</span> <span class="n">tick</span><span class="o">.</span><span class="na">getAsk</span><span class="o">()</span> <span class="o">-</span> <span class="n">instrument</span><span class="o">.</span><span class="na">getPipValue</span><span class="o">()</span> <span class="o">*</span> <span class="mi">15</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">diff</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">engine</span><span class="o">.</span><span class="na">submitOrder</span><span class="o">(</span><span class="n">getLabel</span><span class="o">(</span><span class="n">instrument</span><span class="o">),</span> <span class="n">instrument</span><span class="o">,</span> <span class="n">IEngine</span><span class="o">.</span><span class="na">OrderCommand</span><span class="o">.</span><span class="na">BUY</span><span class="o">,</span> <span class="mf">0.001</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">tick</span><span class="o">.</span><span class="na">getBid</span><span class="o">()</span>
                    <span class="o">-</span> <span class="n">instrument</span><span class="o">.</span><span class="na">getPipValue</span><span class="o">()</span> <span class="o">*</span> <span class="mi">10</span><span class="o">,</span> <span class="n">tick</span><span class="o">.</span><span class="na">getBid</span><span class="o">()</span> <span class="o">+</span> <span class="n">instrument</span><span class="o">.</span><span class="na">getPipValue</span><span class="o">()</span> <span class="o">*</span> <span class="mi">15</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">ma1</span><span class="o">[</span><span class="n">instrument</span><span class="o">.</span><span class="na">ordinal</span><span class="o">()]</span> <span class="o">=</span> <span class="n">ma0</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>


<p>At a glance, you may notice that the variables <code>ma0</code> and <code>ma1</code> play a key role in
determining the setup. <strong>Hint:</strong> To reverse engineer a strategy, it may
be easier to work backward from when the order is placed, which is done
by <code>engine.submitOrder</code> in this case. </p>
<p><code>ma0</code> and <code>ma1</code> hold results from exponential moving averages (EMA). <code>ma0</code> is the current value. <code>ma1</code> is
the previous bar's value. Lines 56--63 check using IF tests (lines 56
and 60) to see if either of the variables hold invalid data. If the data
is invalid, the indicator is calculated and the rest of the onTick is
skipped with the <code>return</code> statement on line 62.</p>
<p><strong>Note:</strong> Indicator values can sometimes be invalid (zero, negative, or <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Double.html">Double.NaN</a>,
depending on the particular indicator implementation) if there is
insufficient data to calculate it or an error occurred, for examples.</p>
<p>The EMAs are fetched in lines 57 and 59 using the IIndicators object
(which was initialized in onStart). The <a href="http://www.dukascopy.com/wiki/index.php?title=Indicators">JForex Wiki provides an
explanation of its use</a>. </p>
<p>Notice that <code>ma1</code> is an array, which was
declared in line 38 with a size equivalent to the number of <a href="http://www.dukascopy.com/client/javadoc/com/dukascopy/api/Instrument.html">all
available JForex instruments</a>. In particular, it is used with a
special index value as in <code>ma1[instrument.ordinal()]</code>. In other words,
it is asking for the current instrument's slot in the <code>ma1</code> array. The
current instrument is the one that is passed into the method in line 55.</p>
<p>Moving down the code, another point of interest is line 65, showing the
use of <a href="http://www.dukascopy.com/client/javadoc/com/dukascopy/api/Instrument.html#getPipValue()">instrument.getPipValue(</a>). Line 67 checks if the current total
number of position is zero. If it is, meaning no opened position, then
the strategy proceeds to check the entry signal to enter a trade (lines
68--76). </p>
<p><code>positionsTotal()</code> is a custom method defined in lines 84--92.
It uses a FOR loop to cycle through all the orders obtained from
[<code>engine.getOrders(instrument)</code>][] </p>
<p>Once either of the long or short
condition, lines 68 and 72, respectively, is met, the strategy submits
an order in lines 69 for a short and line 73 for a long. The
<a href="http://www.dukascopy.com/wiki/index.php?title=Set_Market_Order">particulars of submitting market orders</a> is described in the JForex
Wiki. </p>
<p>When you stop this strategy, onStop (lines 48--53) is called. For
this strategy, the programmer loops through all the orders again using
<code>engine.getOrders()</code> and closes each of the position with an
[<code>order.close()</code>][] command in line 50. </p>
<p>That is it for this trivial
strategy. If there is one point that you should remember. Note my use of
the many links to the <a href="http://www.dukascopy.com/client/javadoc/">JForex javadoc</a> and <a href="http://www.dukascopy.com/wiki/index.php?title=Main_Page">JForex Wiki</a> throughout
this post. You are likely to find many of your answers from those two
sources. If not, there's always the <a href="http://www.dukascopy.com/swiss/english/forex/jforex/forum/">JForex Support Board</a>. Now that
you've had an idea of how MA_Play.java works, it's time to test it. In
the next post in January, we will discuss the JForex Historical Tester
and what to watch for when running a strategy live.</p>
    </div>

    <div class='post-footer'>
        <div class='share-footer'>
            <div id='dated' class="abbr published" title='2010-12-20T09:34:00'>
                Posted 20 December 2010
            </div>

<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
<a class="addthis_button_tweet"></a>
<a class="addthis_button_pinterest_pinit"></a>
<a class="addthis_counter addthis_pill_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=quantisan"></script>
<!-- AddThis Button END -->
 
        </div>

        <div id="article_meta">
            Category:
            <a href="http://www.quantisan.com/category/algorithmic-trading/">algorithmic-trading</a>
            <br />Tags:
            <a href="http://www.quantisan.com/tag/JForex/">JForex</a>
            <a href="http://www.quantisan.com/tag/source code/">source code</a>
            <a href="http://www.quantisan.com/tag/tutorial/">tutorial</a>
        </div>

        <div class='related-posts'>
            <h2>Related Posts:</h2>

            <ul>
                <li><a href="http://www.quantisan.com/getting-started-learning-jforex-programming/">Getting started learning JForex programming</a></li>
                <li><a href="http://www.quantisan.com/anatomy-of-a-jforex-strategy-part-2/">Anatomy of a JForex strategy, Part 2</a></li>
                <li><a href="http://www.quantisan.com/anatomy-of-a-jforex-strategy-part-1/">Anatomy of a JForex strategy, Part 1</a></li>
                <li><a href="http://www.quantisan.com/jforex-example-multiple-time-frame-strategy/">JForex Example:  Multiple-time frame strategy</a></li>
                <li><a href="http://www.quantisan.com/jforex-example-not-letting-profit-turn-to-losses-with-a-breakeven-stop/">JForex Example: Not letting profit turn to losses with a breakeven stop</a></li>
            </ul>            
        </div>

    </div>
</article>

<footer>
    <a href="http://www.quantisan.com/" class="button_accent">&larr;&nbsp;&nbsp;&nbsp;Back to blog</a>
</footer>

<div id="comments">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
    var disqus_identifier = "dissecting-a-jforex-strategy-ma_play-java/";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://quantisan-blog.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view <a href="http://disqus.com/?ref_noscript">comments</a>.</noscript>
</div>
    </section>

<script type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
	</script>
	<script type="text/javascript">
		try {
			var pageTracker = _gat._getTracker("UA-2047602-4");
			pageTracker._trackPageview();
		} catch(err) {}</script>
</body>
</html>